<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ParaGames â€” Play Free Games</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0c0b08;--surf:#161410;--surf2:#1e1c12;--surf3:#252218;
  --bord:#2a2618;--bord2:#363220;
  --txt:#ede7cc;--mut:#857d5f;--mut2:#5a5440;
  --gold:#c9a84c;--gold2:#e8c46a;--gold3:#f5d980;--gold4:#6e5820;
  --red:#e84040;--grn:#38a838;--blu:#4080e0;
  --glow:rgba(201,168,76,0.15);--R:14px;
  --font-head:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;
}
html{scroll-behavior:smooth}
body{font-family:var(--font-body);background:var(--bg);color:var(--txt);min-height:100vh;overflow-x:hidden}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--bord2);border-radius:3px}

/* â”€â”€ VORTEX â”€â”€ */
#vortexCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;opacity:0.22}

/* â”€â”€ NAV â”€â”€ */
nav{display:flex;align-items:center;gap:12px;padding:0 28px;height:58px;border-bottom:1px solid var(--bord);position:sticky;top:0;background:rgba(12,11,8,.95);backdrop-filter:blur(24px);z-index:500}
.logo{font-family:var(--font-head);font-weight:800;font-size:19px;text-decoration:none;color:var(--gold2);display:flex;align-items:center;gap:9px;cursor:pointer;flex-shrink:0;position:relative;z-index:1}
.logo-ic{width:30px;height:30px;background:linear-gradient(135deg,var(--gold),#9a7010);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:15px;position:relative;z-index:2}
.nav-spacer{flex:1}
.nav-search{display:flex;align-items:center;background:var(--surf);border:1px solid var(--bord2);border-radius:22px;padding:7px 16px;gap:8px;max-width:280px;width:100%;transition:all .18s;position:relative;z-index:1}
.nav-search:focus-within{border-color:var(--gold4);box-shadow:0 0 0 3px var(--glow)}
.nav-search input{background:none;border:none;outline:none;color:var(--txt);font-family:inherit;font-size:13px;width:100%}
.nav-search input::placeholder{color:var(--mut)}
.nav-back{display:none;align-items:center;gap:6px;background:var(--surf);border:1px solid var(--bord2);border-radius:20px;padding:6px 14px;cursor:pointer;color:var(--mut);font-size:13px;font-weight:600;transition:all .15s}
.nav-back:hover{color:var(--txt)}
.nav-game-name{display:none;font-family:var(--font-head);font-weight:700;font-size:15px;color:var(--gold2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}
.nav-pause{display:none;align-items:center;gap:6px;background:var(--surf2);border:1px solid var(--bord2);border-radius:20px;padding:6px 16px;cursor:pointer;color:var(--mut);font-size:13px;font-weight:600;transition:all .15s;margin-left:auto}
.nav-pause:hover{color:var(--txt);border-color:var(--gold4)}

/* â”€â”€ HOME HERO â”€â”€ */
.hero{text-align:center;padding:60px 24px 44px;position:relative;overflow:hidden;z-index:1}
.hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(201,168,76,.09) 0%,transparent 60%);pointer-events:none}
.hero-word{font-family:var(--font-head);font-weight:800;font-size:72px;letter-spacing:-4px;line-height:1;margin-bottom:12px;background:linear-gradient(145deg,var(--gold3) 0%,var(--gold) 50%,#7a5a14 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{color:var(--mut);font-size:14px;margin-bottom:0}.hero-sub b{color:var(--gold);font-weight:600}
.hero-stats{display:flex;align-items:center;justify-content:center;gap:24px;margin-top:20px;flex-wrap:wrap}
.stat{text-align:center}
.stat-n{font-family:var(--font-head);font-size:22px;font-weight:800;color:var(--gold2)}
.stat-l{font-size:11px;color:var(--mut);text-transform:uppercase;letter-spacing:.8px}

/* â”€â”€ TRENDING CAROUSEL â”€â”€ */
.trending{padding:0 28px 36px;max-width:1320px;margin:0 auto;position:relative;z-index:1}
.sec-label{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.sec-label h2{font-family:var(--font-head);font-size:11px;font-weight:700;color:var(--mut);letter-spacing:2px;text-transform:uppercase;white-space:nowrap}
.sec-label-line{flex:1;height:1px;background:var(--bord)}
.sec-label .cnt{font-size:11px;font-weight:600;color:var(--mut);background:var(--surf);border:1px solid var(--bord);padding:3px 10px;border-radius:20px}

.trend-card{border-radius:18px;border:1px solid var(--bord2);overflow:hidden;position:relative;cursor:pointer;height:200px;display:flex;align-items:flex-end;transition:transform .2s,box-shadow .2s}
.trend-card:hover{transform:scale(1.01);box-shadow:0 16px 48px rgba(0,0,0,.7)}
.trend-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:90px;filter:blur(0px)}
.trend-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(12,11,8,.95) 0%,rgba(12,11,8,.3) 60%,transparent 100%)}
.trend-content{position:relative;z-index:2;padding:20px 24px;width:100%}
.trend-badge{display:inline-block;background:var(--gold);color:#0c0b08;font-size:10px;font-weight:800;padding:3px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px}
.trend-title{font-family:var(--font-head);font-size:26px;font-weight:800;color:var(--txt);margin-bottom:4px}
.trend-desc{font-size:13px;color:var(--mut);margin-bottom:12px}
.trend-play{display:inline-flex;align-items:center;gap:7px;background:var(--gold);color:#0c0b08;border:none;padding:9px 20px;border-radius:24px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s}
.trend-play:hover{background:var(--gold2);transform:scale(1.04)}
.trend-dots{display:flex;justify-content:center;gap:6px;margin-top:12px}
.trend-dot{width:6px;height:6px;border-radius:3px;background:var(--bord2);cursor:pointer;transition:all .3s}
.trend-dot.active{width:20px;background:var(--gold)}

/* â”€â”€ CATEGORY PILLS â”€â”€ */
.cats{display:flex;gap:6px;flex-wrap:wrap;padding:0 28px 32px;max-width:1320px;margin:0 auto;position:relative;z-index:1}
.pill{padding:7px 15px;border-radius:20px;font-size:11px;font-weight:700;border:1px solid var(--bord);cursor:pointer;transition:all .15s;background:transparent;color:var(--mut);text-transform:uppercase;letter-spacing:.4px;user-select:none;white-space:nowrap}
.pill:hover{border-color:var(--gold4);color:var(--gold);background:var(--glow)}
.pill.active{background:var(--gold);color:#0c0b08;border-color:var(--gold)}

/* â”€â”€ GAME GRID â”€â”€ */
.sec{max-width:1320px;margin:0 auto;padding:0 28px 80px;position:relative;z-index:1}
.ggrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(175px,1fr));gap:12px}

/* â”€â”€ GAME CARD â”€â”€ */
.gcard{border-radius:var(--R);border:1px solid var(--bord);background:var(--surf);overflow:hidden;cursor:pointer;transition:transform .2s,box-shadow .2s,border-color .2s;position:relative}
.gcard:hover{transform:translateY(-4px);box-shadow:0 14px 44px rgba(0,0,0,.65),0 0 0 1px var(--bord2);border-color:var(--bord2)}
.gthumb{width:100%;aspect-ratio:16/9;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.gthumb-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0.18;transition:opacity .2s}
.gcard:hover .gthumb-img{opacity:0.28}
.gthumb-bg{position:absolute;inset:0}
.gthumb-emoji{position:relative;z-index:1;font-size:46px;transition:transform .2s;filter:drop-shadow(0 4px 14px rgba(0,0,0,.6))}
.gcard:hover .gthumb-emoji{transform:scale(1.1)}
.badge-new{position:absolute;top:8px;right:8px;background:var(--red);color:#fff;font-size:9px;font-weight:800;padding:2px 8px;border-radius:10px;z-index:3;text-transform:uppercase;letter-spacing:.5px}
.badge-hot{position:absolute;top:8px;right:8px;background:var(--gold);color:#0c0b08;font-size:9px;font-weight:800;padding:2px 8px;border-radius:10px;z-index:3;text-transform:uppercase;letter-spacing:.5px}
.badge-2p{position:absolute;top:8px;left:8px;background:var(--blu);color:#fff;font-size:9px;font-weight:800;padding:2px 8px;border-radius:10px;z-index:3;text-transform:uppercase;letter-spacing:.5px}
.pring{position:absolute;inset:0;z-index:2;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .18s}
.pcirc{width:44px;height:44px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 0 8px rgba(201,168,76,.2)}
.gcard:hover .pring{opacity:1}
.ginf{padding:10px 12px 12px;border-top:1px solid var(--bord)}
.gname{font-size:13px;font-weight:600;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.gbot{display:flex;align-items:center;justify-content:space-between}
.gcat{font-size:10px;color:var(--mut);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.garr{font-size:10px;color:var(--gold4);font-weight:700;transition:color .15s}
.gcard:hover .garr{color:var(--gold)}
.nores{display:none;text-align:center;padding:80px 24px;color:var(--mut)}
.nores.show{display:block}

/* â”€â”€ GAME SCREEN â”€â”€ */
#GS{display:none;position:fixed;inset:0;background:var(--bg);z-index:400;flex-direction:column}
#GS.open{display:flex}
.gs-body{flex:1;display:flex;align-items:center;justify-content:center;overflow:auto;position:relative}

/* â”€â”€ OVERLAYS â”€â”€ */
.g-overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(8,7,4,.9);backdrop-filter:blur(8px);z-index:50;gap:8px;padding:24px}
.g-overlay h2{font-family:var(--font-head);font-size:36px;font-weight:800;color:var(--gold2);margin-bottom:4px;text-align:center}
.g-overlay .sub{color:var(--mut);font-size:14px;text-align:center;margin-bottom:10px}
.g-overlay .score-row{font-family:var(--font-head);font-size:20px;color:var(--gold);margin-bottom:4px}
.ov-btns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:6px}
.btn-gold{background:var(--gold);color:#0c0b08;border:none;padding:12px 30px;border-radius:28px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-gold:hover{background:var(--gold2);transform:scale(1.04)}
.btn-out{background:transparent;color:var(--mut);border:1px solid var(--bord2);padding:12px 22px;border-radius:28px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-out:hover{color:var(--txt);border-color:var(--gold4)}

/* â”€â”€ HUD â”€â”€ */
.hud-row{display:flex;gap:10px;padding:10px 20px 0;flex-shrink:0;flex-wrap:wrap;justify-content:center}
.hb{background:rgba(12,11,8,.85);border:1px solid var(--bord2);border-radius:10px;padding:5px 14px;text-align:center}
.hl{font-size:9px;color:var(--mut);text-transform:uppercase;letter-spacing:1px;font-weight:600}
.hv{font-family:var(--font-head);font-size:20px;font-weight:700;color:var(--gold2);line-height:1.2}

/* 2048 */
#b2048{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;background:#161410;padding:10px;border-radius:12px;touch-action:none}
.tile{width:88px;height:88px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:var(--font-head);font-weight:800;font-size:26px;background:#2a2618;color:var(--mut)}
.t2{background:#3a2e14;color:#f0d080}.t4{background:#4a3818;color:#f0d080}.t8{background:#b86c1a;color:#fff}.t16{background:#c05818;color:#fff}.t32{background:#c84010;color:#fff}.t64{background:#d82808;color:#fff}.t128{background:var(--gold);color:#0c0b08;font-size:20px}.t256{background:#d4b050;color:#0c0b08;font-size:20px}.t512{background:#dcc060;color:#0c0b08;font-size:18px}.t1024{background:#e4cc70;color:#0c0b08;font-size:16px}.t2048{background:#f0d880;color:#0c0b08;font-size:16px}

/* MINESWEEPER */
#msG{display:inline-grid;gap:3px;padding:10px;background:#161410;border-radius:12px;border:1px solid var(--bord2)}
.mc{width:36px;height:36px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;cursor:pointer;user-select:none;background:var(--surf2);border:1px solid var(--bord2);font-family:var(--font-head)}
.mc:hover:not(.mr):not(.mf){background:#2e2b1a}.mr{background:#141210;border-color:#201e10;cursor:default}.mhit{background:#6e0000!important}.mf{background:#2a2200}
.m1{color:#4a90d9}.m2{color:#48a848}.m3{color:#d94040}.m4{color:#3030a8}.m5{color:#a02020}.m6{color:#30a0a0}.m7{color:var(--gold)}.m8{color:#808080}

/* CONNECT 4 */
#c4board{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;background:#161410;padding:10px;border-radius:14px;border:1px solid var(--bord2)}
.c4cell{width:54px;height:54px;border-radius:50%;background:#0c0b08;border:2px solid var(--bord);cursor:pointer;transition:all .1s}
.c4cell:hover{border-color:var(--gold4)}.c4r{background:radial-gradient(circle at 35% 35%,#ff6060,#c82020)}.c4y{background:radial-gradient(circle at 35% 35%,var(--gold2),var(--gold4))}

/* WORDLE */
#wgrid{display:flex;flex-direction:column;gap:6px;margin:10px 0}
.wrow{display:flex;gap:6px}
.wletter{width:54px;height:54px;border:2px solid var(--bord2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:var(--font-head);font-size:22px;font-weight:800;color:var(--txt);text-transform:uppercase;transition:all .15s;background:var(--surf)}
.wletter.correct{background:#38a838;border-color:#38a838;color:#fff}.wletter.present{background:#b8960a;border-color:#b8960a;color:#fff}.wletter.absent{background:#3a3820;border-color:#3a3820;color:var(--mut)}.wletter.cur{border-color:var(--gold)}
.wkb{display:flex;flex-direction:column;gap:5px;align-items:center}
.wkrow{display:flex;gap:4px}
.wk{min-width:34px;height:44px;padding:0 6px;background:var(--surf2);border:1px solid var(--bord2);border-radius:7px;display:flex;align-items:center;justify-content:center;font-family:var(--font-head);font-size:12px;font-weight:700;color:var(--txt);cursor:pointer;transition:background .1s;user-select:none}
.wk:hover{background:#2e2b1a}.wk.wc{background:#38a838;border-color:#38a838}.wk.wp{background:#b8960a;border-color:#b8960a}.wk.wa{background:#3a3820;border-color:#3a3820;color:var(--mut)}.wk.wide{min-width:54px;font-size:11px}

/* TRIVIA */
.trivia-q{font-family:var(--font-head);font-size:20px;font-weight:700;color:var(--txt);text-align:center;margin-bottom:20px;line-height:1.4;max-width:500px}
.trivia-opts{display:flex;flex-direction:column;gap:10px;width:100%;max-width:480px}
.trivia-opt{background:var(--surf2);border:2px solid var(--bord2);border-radius:12px;padding:14px 18px;cursor:pointer;font-size:14px;font-weight:500;color:var(--txt);transition:all .15s;text-align:left}
.trivia-opt:hover:not(.locked){border-color:var(--gold4);background:var(--surf3)}
.trivia-opt.correct{border-color:#38a838;background:rgba(56,168,56,.15);color:#38a838}
.trivia-opt.wrong{border-color:#e84040;background:rgba(232,64,64,.12);color:#e84040}
.trivia-prog{width:100%;max-width:480px;height:4px;background:var(--bord);border-radius:2px;overflow:hidden;margin-bottom:16px}
.trivia-prog-fill{height:100%;background:var(--gold);border-radius:2px;transition:width .3s}

/* TYPING */
.ty-text-wrap{background:var(--surf);border:1px solid var(--bord2);border-radius:12px;padding:20px 24px;font-family:var(--font-body);font-size:17px;line-height:1.9;color:var(--mut);letter-spacing:.3px;min-height:90px;max-width:620px;width:100%}
.ty-c{color:var(--grn)}.ty-e{color:var(--red);text-decoration:underline}.ty-cur{border-left:2px solid var(--gold2)}

/* FOOTER */
footer{border-top:1px solid var(--bord);padding:22px 24px;text-align:center;font-size:12px;color:var(--mut);position:relative;z-index:1}
footer a{color:var(--gold4);text-decoration:none}

@media(max-width:680px){
  .hero-word{font-size:46px;letter-spacing:-2px}
  nav{padding:0 14px;gap:8px}.nav-search{max-width:160px}
  .ggrid{grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:10px}
  .tile{width:70px;height:70px;font-size:20px}
  .mc{width:28px;height:28px;font-size:11px}
  .c4cell{width:40px;height:40px}
  .wletter{width:44px;height:44px;font-size:18px}
  .trending,.cats,.sec{padding-left:14px;padding-right:14px}
}
</style>
</head>
<body>

<!-- PARALLAX VORTEX -->
<canvas id="vortexCanvas"></canvas>

<!-- â•â•â• NAV â•â•â• -->
<nav id="mainNav">
  <div class="logo" id="navLogo" onclick="goHome()">
    <div class="logo-ic">ğŸ®</div>ParaGames
  </div>
  <div class="nav-spacer" id="navSpacer"></div>
  <div class="nav-search" id="navSearchBox">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" id="srchIn" placeholder="Search 25 games..." autocomplete="off"/>
  </div>
  <span class="nav-game-name" id="navGameName"></span>
  <button class="nav-pause" id="navPause" onclick="togglePause()">â¸ Pause</button>
  <button class="nav-back" id="navBack" onclick="goHome()">âœ• Exit</button>
</nav>

<!-- â•â•â• HOME â•â•â• -->
<div id="homePage">
  <div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-word">ParaGames</div>
    <p class="hero-sub"><b>25 games.</b> Self-hosted. Zero ads. Zero blocks.</p>
    <div class="hero-stats">
      <div class="stat"><div class="stat-n">25</div><div class="stat-l">Games</div></div>
      <div class="stat"><div class="stat-n">0</div><div class="stat-l">Ads</div></div>
      <div class="stat"><div class="stat-n">âˆ</div><div class="stat-l">Fun</div></div>
      <div class="stat"><div class="stat-n">Free</div><div class="stat-l">Always</div></div>
    </div>
  </div>

  <div class="trending">
    <div class="sec-label">
      <h2>ğŸ”¥ Trending Now</h2>
      <div class="sec-label-line"></div>
      <div class="cnt">Changes every 5s</div>
    </div>
    <div class="trend-card" id="trendCard" onclick="onTrendClick()">
      <div class="trend-bg" id="trendBg"></div>
      <div class="trend-overlay"></div>
      <div class="trend-content">
        <div class="trend-badge">ğŸ”¥ Trending</div>
        <div class="trend-title" id="trendTitle">Loading...</div>
        <div class="trend-desc" id="trendDesc"></div>
        <button class="trend-play"><svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> Play Now</button>
      </div>
    </div>
    <div class="trend-dots" id="trendDots"></div>
  </div>

  <div class="cats" id="catRow">
    <div class="pill active" data-cat="all">ğŸ® All</div>
    <div class="pill" data-cat="arcade">ğŸ•¹ Arcade</div>
    <div class="pill" data-cat="puzzle">ğŸ§© Puzzle</div>
    <div class="pill" data-cat="2player">ğŸ‘¥ 2 Player</div>
    <div class="pill" data-cat="action">âš”ï¸ Action</div>
    <div class="pill" data-cat="word">ğŸ“ Word</div>
    <div class="pill" data-cat="strategy">â™Ÿ Strategy</div>
    <div class="pill" data-cat="music">ğŸµ Music</div>
    <div class="pill" data-cat="fighting">ğŸ¥Š Fighting</div>
    <div class="pill" data-cat="racing">ğŸ Racing</div>
    <div class="pill" data-cat="reflex">âš¡ Reflex</div>
  </div>

  <div class="sec">
    <div class="sec-label">
      <h2 id="gridLabel">All Games</h2>
      <div class="sec-label-line"></div>
      <div class="cnt" id="cntEl">25 games</div>
    </div>
    <div class="ggrid" id="gGrid"></div>
    <div class="nores" id="noRes">
      <div style="font-size:52px;margin-bottom:16px">ğŸ®</div>
      <h3 style="color:var(--txt);font-size:18px;margin-bottom:6px">No games found</h3>
      <p>Try a different search or category</p>
    </div>
  </div>

  <footer>Â© 2025 ParaGames Â· All games self-hosted Â· <a href="https://pages.github.com" target="_blank">Host free on GitHub Pages</a> Â· Zero ads ever</footer>
</div>

<!-- â•â•â• GAME SCREEN â•â•â• -->
<div id="GS">
  <div class="gs-body" id="gsBody"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARALLAX GOLDEN VORTEX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const canvas = document.getElementById('vortexCanvas');
  const ctx = canvas.getContext('2d');
  let W, H, mx = 0, my = 0, scrollY = 0;
  let particles = [];
  const N = 180;

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  window.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
  window.addEventListener('scroll', () => { scrollY = window.scrollY; });

  for (let i = 0; i < N; i++) {
    const angle = (i / N) * Math.PI * 2 * 7;
    const radius = 30 + (i / N) * 320;
    particles.push({
      baseAngle: angle,
      baseRadius: radius,
      speed: 0.0003 + Math.random() * 0.0004,
      size: 0.5 + Math.random() * 2.5,
      opacity: 0.1 + Math.random() * 0.6,
      phase: Math.random() * Math.PI * 2,
      drift: (Math.random() - 0.5) * 0.5,
    });
  }

  let t = 0;
  function draw() {
    ctx.clearRect(0, 0, W, H);

    // parallax offset from mouse and scroll
    const px = (mx / W - 0.5) * 60;
    const py = (my / H - 0.5) * 40 - scrollY * 0.08;
    const cx = W * 0.12 + px;
    const cy = H * 0.35 + py;

    particles.forEach((p, i) => {
      const angle = p.baseAngle + t * p.speed * 1000 + p.drift * t * 0.01;
      const wobble = Math.sin(t * 0.8 + p.phase) * 18;
      const r = p.baseRadius + wobble;
      const x = cx + Math.cos(angle) * r;
      const y = cy + Math.sin(angle) * r * 0.38; // flatten into ellipse

      const progress = i / N;
      const gold = `hsla(${42 + Math.sin(p.phase + t * 0.5) * 12}, 80%, ${55 + progress * 20}%, ${p.opacity * (0.5 + 0.5 * Math.sin(t * 0.3 + p.phase))})`;

      ctx.beginPath();
      ctx.arc(x, y, p.size, 0, Math.PI * 2);
      ctx.fillStyle = gold;
      ctx.fill();
    });

    // Draw spiral arms as curves
    for (let arm = 0; arm < 3; arm++) {
      ctx.beginPath();
      for (let j = 0; j < 120; j++) {
        const frac = j / 120;
        const angle = (arm / 3) * Math.PI * 2 + frac * Math.PI * 6 + t * 0.0004;
        const r = 20 + frac * 300 + Math.sin(t * 0.5 + frac * 8) * 10;
        const x = cx + Math.cos(angle) * r;
        const y = cy + Math.sin(angle) * r * 0.38;
        if (j === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.strokeStyle = `hsla(42, 70%, 60%, ${0.04 + 0.02 * arm})`;
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    t += 0.016;
    requestAnimationFrame(draw);
  }
  draw();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME REGISTRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GAMES = [
  // ARCADE
  {id:'snake',     name:'Snake',           cat:'arcade',   e:'ğŸ',  c1:'#0d3020',c2:'#1a6040', hot:true,  desc:'Classic snake â€” eat & grow without crashing!'},
  {id:'flappy',    name:'Flappy Bird',     cat:'arcade',   e:'ğŸ¦',  c1:'#0a1f35',c2:'#1a4070', isnew:false,desc:'Tap to fly through pipes! How far can you go?'},
  {id:'dino',      name:'Dino Run',        cat:'arcade',   e:'ğŸ¦•',  c1:'#1a1a1a',c2:'#333',    hot:true,  desc:'Google\'s famous dino â€” jump cacti, survive!'},
  {id:'pacman',    name:'Pac-Man',         cat:'arcade',   e:'ğŸ‘¾',  c1:'#1e1c00',c2:'#3a3800', hot:true,  desc:'Eat dots, dodge ghosts, eat power pellets!'},
  {id:'breakout',  name:'Breakout',        cat:'arcade',   e:'ğŸ§±',  c1:'#200018',c2:'#400030', isnew:false,desc:'Classic Atari Breakout â€” smash all the bricks!'},
  // PUZZLE
  {id:'tetris',    name:'Tetris',          cat:'puzzle',   e:'ğŸŸ¦',  c1:'#001628',c2:'#003060', hot:true,  desc:'Stack blocks, clear lines, beat your score!'},
  {id:'g2048',     name:'2048',            cat:'puzzle',   e:'ğŸ”¢',  c1:'#1c1808',c2:'#3a3010', isnew:false,desc:'Merge tiles to reach 2048!'},
  {id:'minesweep', name:'Minesweeper',     cat:'puzzle',   e:'ğŸ’£',  c1:'#0a1400',c2:'#183000', isnew:false,desc:'Classic Windows Minesweeper â€” avoid all mines!'},
  {id:'sudoku',    name:'Sudoku',          cat:'puzzle',   e:'ğŸ”²',  c1:'#0a0a20',c2:'#14145a', isnew:true, desc:'Fill the 9Ã—9 grid â€” every row, column & box!'},
  // WORD
  {id:'wordle',    name:'Wordle',          cat:'word',     e:'ğŸŸ©',  c1:'#0a180a',c2:'#143214', isnew:false,desc:'NYT-style â€” guess the 5-letter word in 6 tries!'},
  {id:'trivia',    name:'Trivia Quiz',     cat:'word',     e:'ğŸ¯',  c1:'#140a2e',c2:'#281460', isnew:true, desc:'250+ questions across 5 categories. Beat them all!'},
  {id:'typing',    name:'Typing Speed',    cat:'word',     e:'âŒ¨ï¸',  c1:'#0a1020',c2:'#142040', isnew:true, desc:'Like TypeRacer â€” how many WPM can you hit?'},
  // 2 PLAYER
  {id:'pong',      name:'Pong',            cat:'2player',  e:'ğŸ“',  c1:'#001020',c2:'#002040', isnew:false,desc:'Classic Pong! P1: W/S Â· P2: â†‘/â†“ Â· First to 7!'},
  {id:'connect4',  name:'Connect Four',    cat:'2player',  e:'ğŸ”´',  c1:'#001428',c2:'#002850', isnew:false,desc:'Drop pieces, get 4 in a row to win!'},
  {id:'tictac',    name:'Tic-Tac-Toe',    cat:'2player',  e:'âŒ',  c1:'#14082a',c2:'#281458', isnew:false,desc:'Classic X vs O â€” who gets 3 in a row first?'},
  {id:'fighter',   name:'Street Fighter',  cat:'fighting', e:'ğŸ¥Š',  c1:'#200008',c2:'#400010', isnew:true, desc:'2-Player fighting! WASD+F vs Arrows+L Â· First to 3!'},
  // ACTION / REFLEX
  {id:'spaceshoot',name:'Space Shooter',   cat:'action',   e:'ğŸš€',  c1:'#000820',c2:'#001440', hot:true,  desc:'Galaga-style shooter â€” destroy waves of aliens!'},
  {id:'reaction',  name:'Reaction Time',   cat:'reflex',   e:'âš¡',  c1:'#1a0820',c2:'#340f40', isnew:true, desc:'Click when it turns green â€” test your reflexes!'},
  {id:'aim',       name:'Aim Trainer',     cat:'reflex',   e:'ğŸ¯',  c1:'#200010',c2:'#400020', isnew:true, desc:'Click targets as fast as you can â€” beat your score!'},
  {id:'whack',     name:'Whack-a-Mole',   cat:'reflex',   e:'ğŸ”¨',  c1:'#1a1000',c2:'#3a2800', isnew:true, desc:'Hit the moles before they disappear! How fast?'},
  // STRATEGY
  {id:'memory',    name:'Memory Match',    cat:'strategy', e:'ğŸƒ',  c1:'#1a0a10',c2:'#341420', isnew:false,desc:'Flip cards and match all pairs with fewest moves!'},
  {id:'checkers',  name:'Checkers',        cat:'strategy', e:'âš«',  c1:'#0a0a0a',c2:'#202020', isnew:true, desc:'Classic draughts/checkers â€” jump and capture pieces!'},
  {id:'simon',     name:'Simon Says',      cat:'strategy', e:'ğŸ”µ',  c1:'#001428',c2:'#002850', isnew:true, desc:'Remember the color sequence â€” how far can you go?'},
  // MUSIC
  {id:'rhythm',    name:'Rhythm Tap',      cat:'music',    e:'ğŸµ',  c1:'#1a0030',c2:'#340060', isnew:true, desc:'Guitar Hero style â€” hit the notes on the beat!'},
  // RACING
  {id:'racing3d',  name:'Road Racer',      cat:'racing',   e:'ğŸï¸', c1:'#0a1400',c2:'#142800', isnew:true, desc:'Pseudo-3D OutRun style racing â€” dodge traffic!'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRENDING CAROUSEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TRENDING = ['snake','pacman','dino','spaceshoot','fighter','rhythm','racing3d','tetris','trivia','whack','simon'];
let tIdx = 0, tTimer;

function buildTrendDots() {
  const d = document.getElementById('trendDots');
  d.innerHTML = '';
  TRENDING.forEach((_, i) => {
    const dot = document.createElement('div');
    dot.className = 'trend-dot' + (i === 0 ? ' active' : '');
    dot.onclick = () => { tIdx = i; showTrend(); };
    d.appendChild(dot);
  });
}

function showTrend() {
  const g = GAMES.find(x => x.id === TRENDING[tIdx]);
  if (!g) return;
  document.getElementById('trendBg').textContent = g.e;
  document.getElementById('trendBg').style.cssText = `position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:100px;background:radial-gradient(ellipse at 40% 50%,${g.c2} 0%,${g.c1} 60%,#0c0b08 100%)`;
  document.getElementById('trendTitle').textContent = g.name;
  document.getElementById('trendDesc').textContent = g.desc;
  document.querySelectorAll('.trend-dot').forEach((d, i) => d.classList.toggle('active', i === tIdx));
}

function onTrendClick() { startGame(TRENDING[tIdx]); }

function startTrendCycle() {
  buildTrendDots();
  showTrend();
  tTimer = setInterval(() => { tIdx = (tIdx + 1) % TRENDING.length; showTrend(); }, 5000);
}
startTrendCycle();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME GRID
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const gGrid = document.getElementById('gGrid');
const srch = document.getElementById('srchIn');
const noRes = document.getElementById('noRes');
const cntEl = document.getElementById('cntEl');
let curCat = 'all';

const CAT_ICON_COLORS = {
  arcade:['#e84040','#ff6060'], puzzle:['#4080e0','#60a0ff'],
  '2player':['#38a838','#60c860'], action:['#e87030','#ff9050'],
  word:['#a050e8','#c070ff'], strategy:['#c8a44a','#e8c46a'],
  music:['#e84080','#ff60a0'], fighting:['#e84040','#c82020'],
  racing:['#38a838','#20c020'], reflex:['#e8c44a','#ffd060']
};

function buildGameCard(g) {
  const d = document.createElement('div');
  d.className = 'gcard';
  const [ic1, ic2] = CAT_ICON_COLORS[g.cat] || ['#c8a44a','#e8c46a'];
  const badgeHTML = g.hot ? '<div class="badge-hot">ğŸ”¥ Hot</div>' : g.isnew ? '<div class="badge-new">New</div>' : '';
  const is2p = (g.cat === '2player' || g.cat === 'fighting') ? '<div class="badge-2p">2P</div>' : '';
  d.innerHTML = `
    <div class="gthumb" style="background:radial-gradient(ellipse at 40% 40%,${g.c2} 0%,${g.c1} 70%,#0c0b08 100%)">
      ${badgeHTML}${is2p}
      <span class="gthumb-emoji">${g.e}</span>
      <div class="pring"><div class="pcirc">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="#0c0b08"><path d="M8 5v14l11-7z"/></svg>
      </div></div>
    </div>
    <div class="ginf">
      <div class="gname">${g.name}</div>
      <div class="gbot"><span class="gcat">${g.cat}</span><span class="garr">Play â–¶</span></div>
    </div>`;
  d.onclick = () => startGame(g.id);
  return d;
}

function renderHome(list) {
  gGrid.innerHTML = '';
  cntEl.textContent = list.length + ' game' + (list.length !== 1 ? 's' : '');
  if (!list.length) { noRes.classList.add('show'); return; }
  noRes.classList.remove('show');
  list.forEach(g => gGrid.appendChild(buildGameCard(g)));
}

function filterHome() {
  const q = srch.value.toLowerCase();
  let list = GAMES;
  if (curCat !== 'all') list = list.filter(g => g.cat === curCat);
  if (q) list = list.filter(g => g.name.toLowerCase().includes(q) || g.cat.includes(q) || g.desc.toLowerCase().includes(q));
  renderHome(list);
}

document.querySelectorAll('.pill').forEach(p => {
  p.addEventListener('click', () => {
    document.querySelectorAll('.pill').forEach(x => x.classList.remove('active'));
    p.classList.add('active');
    curCat = p.dataset.cat;
    document.getElementById('gridLabel').textContent = p.textContent;
    filterHome();
  });
});
srch.addEventListener('input', filterHome);
renderHome(GAMES);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeId = null, paused = false;
const CLEANERS = {}, PAUSE_CBS = {};

function startGame(id) {
  activeId = id;
  paused = false;
  const g = GAMES.find(x => x.id === id);
  document.getElementById('homePage').style.display = 'none';
  document.getElementById('GS').classList.add('open');
  document.getElementById('navBack').style.display = 'flex';
  document.getElementById('navPause').style.display = 'flex';
  document.getElementById('navSearchBox').style.display = 'none';
  document.getElementById('navSpacer').style.display = 'none';
  document.getElementById('navGameName').style.display = 'block';
  document.getElementById('navGameName').textContent = g ? g.e + ' ' + g.name : '';
  document.getElementById('gsBody').innerHTML = '';
  if (BUILDERS[id]) BUILDERS[id](document.getElementById('gsBody'));
}

function goHome() {
  if (activeId && CLEANERS[activeId]) CLEANERS[activeId]();
  activeId = null;
  paused = false;
  document.getElementById('GS').classList.remove('open');
  document.getElementById('homePage').style.display = '';
  document.getElementById('navBack').style.display = 'none';
  document.getElementById('navPause').style.display = 'none';
  document.getElementById('navPause').textContent = 'â¸ Pause';
  document.getElementById('navSearchBox').style.display = 'flex';
  document.getElementById('navSpacer').style.display = '';
  document.getElementById('navGameName').style.display = 'none';
  document.getElementById('gsBody').innerHTML = '';
}

function togglePause() {
  if (!activeId || !PAUSE_CBS[activeId]) return;
  paused = !paused;
  document.getElementById('navPause').textContent = paused ? 'â–¶ Resume' : 'â¸ Pause';
  PAUSE_CBS[activeId](paused);
}

const BUILDERS = {};

function mkOv(wrap, title, sub, btns) {
  let ov = wrap.querySelector('.g-overlay');
  if (!ov) { ov = document.createElement('div'); ov.className = 'g-overlay'; wrap.appendChild(ov); }
  ov.innerHTML = `<h2>${title}</h2><p class="sub">${sub}</p><div class="ov-btns">${btns}</div>`;
  ov.style.display = 'flex';
  return ov;
}

function hideOv(wrap) {
  const ov = wrap.querySelector('.g-overlay');
  if (ov) ov.style.display = 'none';
}

function cvBanner(ctx, W, H, title, sub, hint, color='#e8c46a') {
  ctx.fillStyle = 'rgba(8,7,4,.88)';
  ctx.fillRect(0, 0, W, H);
  ctx.textAlign = 'center';
  ctx.font = `800 ${Math.min(34, W/10)}px Syne,sans-serif`;
  ctx.fillStyle = color;
  ctx.fillText(title, W/2, H/2 - 44);
  if (sub) { ctx.font = `500 ${Math.min(15, W/28)}px DM Sans,sans-serif`; ctx.fillStyle = '#857d5f'; ctx.fillText(sub, W/2, H/2 - 6); }
  if (hint) { ctx.font = `700 ${Math.min(13, W/32)}px DM Sans,sans-serif`; ctx.fillStyle = '#c9a84c'; ctx.fillText(hint, W/2, H/2 + 38); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SNAKE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.snake = function(wrap) {
  const SZ=20, C=25, R=20, W=C*SZ, H=R*SZ;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="snkS">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="snkB">0</div></div><div class="hb"><div class="hl">Length</div><div class="hv" id="snkL">3</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative;width:100%">
  <canvas id="snkCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%;max-height:70vh"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:10px">Arrow/WASD Â· Space=start/pause</p>`;
  const cv = document.getElementById('snkCv'), ctx = cv.getContext('2d');
  let snake, dir, ndir, food, score, best=0, loop, state='idle';
  const rnd = m => Math.floor(Math.random() * m);
  function newFood() { let f; do { f = {x:rnd(C), y:rnd(R)}; } while (snake.some(s => s.x===f.x && s.y===f.y)); return f; }
  function upHUD() { document.getElementById('snkS').textContent=score; document.getElementById('snkB').textContent=best; document.getElementById('snkL').textContent=snake.length; }
  function draw() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    const pulse = 0.88 + Math.sin(Date.now()/280)*0.12;
    ctx.fillStyle='#e84040'; ctx.shadowColor='#e84040'; ctx.shadowBlur=14*pulse;
    ctx.beginPath(); ctx.arc(food.x*SZ+SZ/2, food.y*SZ+SZ/2, (SZ/2-2)*pulse, 0, Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
    snake.forEach((s,i) => { const t=1-i/snake.length; ctx.fillStyle=`hsl(42,${55+t*20}%,${28+t*26}%)`; ctx.beginPath(); ctx.roundRect(s.x*SZ+1,s.y*SZ+1,SZ-2,SZ-2,4); ctx.fill(); });
  }
  function step() {
    if (state !== 'running') return;
    dir = {...ndir};
    const head = {x:(snake[0].x+dir.x+C)%C, y:(snake[0].y+dir.y+R)%R};
    if (snake.some(s => s.x===head.x && s.y===head.y)) {
      clearInterval(loop); state='dead'; if (score>best) best=score; draw();
      cvBanner(ctx,W,H,'GAME OVER','Score: '+score+'   Best: '+best,'SPACE / Tap to Restart'); return;
    }
    snake.unshift(head);
    if (head.x===food.x && head.y===food.y) { score++; food=newFood(); } else snake.pop();
    upHUD(); draw();
  }
  function startRun() { clearInterval(loop); snake=[{x:12,y:10},{x:11,y:10},{x:10,y:10}]; dir={x:1,y:0}; ndir={x:1,y:0}; food=newFood(); score=0; upHUD(); state='running'; loop=setInterval(step,110); }
  draw(); cvBanner(ctx,W,H,'SNAKE','Eat the red dot â€” don\'t crash!','SPACE or Tap to Start');
  const kH = e => {
    if (e.code==='Space'||e.key==='p'||e.key==='P') {
      e.preventDefault();
      if (state==='idle'||state==='dead') startRun();
      else if (state==='running') { state='paused'; clearInterval(loop); draw(); cvBanner(ctx,W,H,'PAUSED','','SPACE to Resume'); }
      else if (state==='paused') { state='running'; loop=setInterval(step,110); }
      return;
    }
    if (state!=='running') return;
    if (e.key==='ArrowUp'&&dir.y!==1) ndir={x:0,y:-1};
    else if (e.key==='ArrowDown'&&dir.y!==-1) ndir={x:0,y:1};
    else if (e.key==='ArrowLeft'&&dir.x!==1) ndir={x:-1,y:0};
    else if (e.key==='ArrowRight'&&dir.x!==-1) ndir={x:1,y:0};
    else if (e.key==='w'&&dir.y!==1) ndir={x:0,y:-1};
    else if (e.key==='s'&&dir.y!==-1) ndir={x:0,y:1};
    else if (e.key==='a'&&dir.x!==1) ndir={x:-1,y:0};
    else if (e.key==='d'&&dir.x!==-1) ndir={x:1,y:0};
  };
  window.addEventListener('keydown', kH);
  let tx=0, ty=0;
  cv.addEventListener('touchstart', e => { tx=e.touches[0].clientX; ty=e.touches[0].clientY; }, {passive:true});
  cv.addEventListener('touchend', e => {
    const dx=e.changedTouches[0].clientX-tx, dy=e.changedTouches[0].clientY-ty;
    if (Math.abs(dx)<10&&Math.abs(dy)<10) { if (state!=='running') startRun(); return; }
    if (Math.abs(dx)>Math.abs(dy)) { if (dx>15&&dir.x!==-1) ndir={x:1,y:0}; else if (dx<-15&&dir.x!==1) ndir={x:-1,y:0}; }
    else { if (dy>15&&dir.y!==-1) ndir={x:0,y:1}; else if (dy<-15&&dir.y!==1) ndir={x:0,y:-1}; }
  });
  PAUSE_CBS.snake = p => { if(p){state='paused';clearInterval(loop);draw();cvBanner(ctx,W,H,'PAUSED','','Resume to continue');}else{state='running';loop=setInterval(step,110);} };
  CLEANERS.snake = () => { clearInterval(loop); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TETRIS â€” fixed canMove/valid naming conflict
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.tetris = function(wrap) {
  const COLS=10, ROWS=20, SZ=28, W=COLS*SZ, H=ROWS*SZ;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="tS">0</div></div><div class="hb"><div class="hl">Lines</div><div class="hv" id="tL">0</div></div><div class="hb"><div class="hl">Level</div><div class="hv" id="tLv">1</div></div><div class="hb" style="padding:5px 12px"><div class="hl" style="margin-bottom:4px">Next</div><canvas id="tNx" width="64" height="64"></canvas></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%">
  <canvas id="tCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-height:70vh"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Arrows Â· Z/â†‘=Rotate Â· Space=Drop Â· P=Pause</p>`;
  const cv = document.getElementById('tCv'), ctx = cv.getContext('2d');
  const nx = document.getElementById('tNx'), nctx = nx.getContext('2d');
  const PIECES = [
    {s:[[1,1,1,1]], c:'#00d4d4'},
    {s:[[1,1],[1,1]], c:'#e8c46a'},
    {s:[[0,1,0],[1,1,1]], c:'#a050e8'},
    {s:[[1,0,0],[1,1,1]], c:'#e87030'},
    {s:[[0,0,1],[1,1,1]], c:'#4080e0'},
    {s:[[0,1,1],[1,1,0]], c:'#50c850'},
    {s:[[1,1,0],[0,1,1]], c:'#e84040'},
  ];
  let board, piece, next, score, lines, level, raf, state='idle', last=0, acc=0;
  const newBoard = () => Array.from({length:ROWS}, () => Array(COLS).fill(0));
  const rand = () => { const p=PIECES[Math.floor(Math.random()*PIECES.length)]; return {s:p.s.map(r=>[...r]), c:p.c, x:3, y:0}; };
  const rotate = s => s[0].map((_,i) => s.map(r => r[i]).reverse());
  // FIXED: single function name "canFit" used consistently
  const canFit = (s, ox, oy) => s.every((r,y) => r.every((v,x) => !v || (ox+x>=0 && ox+x<COLS && oy+y<ROWS && !board[oy+y]?.[ox+x])));

  function place() {
    piece.s.forEach((r,y) => r.forEach((v,x) => { if(v) board[piece.y+y][piece.x+x]=piece.c; }));
    let cl = 0;
    for (let y=ROWS-1; y>=0; y--) {
      if (board[y].every(v => v)) { board.splice(y,1); board.unshift(Array(COLS).fill(0)); cl++; y++; }
    }
    score += [0,100,300,500,800][cl] * level;
    lines += cl; level = Math.floor(lines/10)+1;
    document.getElementById('tS').textContent=score;
    document.getElementById('tL').textContent=lines;
    document.getElementById('tLv').textContent=level;
    piece = next; next = rand();
    if (!canFit(piece.s, piece.x, piece.y)) { state='gameover'; cancelAnimationFrame(raf); draw(); cvBanner(ctx,W,H,'GAME OVER','Score: '+score+' Â· Level: '+level,'SPACE to Restart'); }
    drawNext();
  }
  function dc(c,x,y,s,col) { c.fillStyle=col; c.fillRect(x*s+1,y*s+1,s-2,s-2); c.fillStyle='rgba(255,255,255,.16)'; c.fillRect(x*s+1,y*s+1,s-2,4); }
  function drawNext() { nctx.fillStyle='#0c0b08'; nctx.fillRect(0,0,64,64); const s=13,ox=(64-next.s[0].length*s)/2,oy=(64-next.s.length*s)/2; next.s.forEach((r,y)=>r.forEach((v,x)=>{if(v)dc(nctx,ox/s+x,oy/s+y,s,next.c)})); }
  function draw() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    ctx.strokeStyle='#161410'; ctx.lineWidth=1;
    for(let x=0;x<=COLS;x++){ctx.beginPath();ctx.moveTo(x*SZ,0);ctx.lineTo(x*SZ,H);ctx.stroke();}
    for(let y=0;y<=ROWS;y++){ctx.beginPath();ctx.moveTo(0,y*SZ);ctx.lineTo(W,y*SZ);ctx.stroke();}
    board.forEach((row,y) => row.forEach((v,x) => { if(v) dc(ctx,x,y,SZ,v); }));
    // ghost piece
    let gy = piece.y;
    while (canFit(piece.s, piece.x, gy+1)) gy++;
    piece.s.forEach((r,y)=>r.forEach((v,x)=>{if(v){ctx.fillStyle='rgba(201,168,76,.1)';ctx.fillRect((piece.x+x)*SZ+1,(gy+y)*SZ+1,SZ-2,SZ-2);}}));
    piece.s.forEach((r,y)=>r.forEach((v,x)=>{if(v)dc(ctx,piece.x+x,piece.y+y,SZ,piece.c);}));
  }
  function loop(ts) {
    if (state!=='running') return;
    const dt=ts-last; last=ts; acc+=dt;
    const intv=Math.max(80,600-level*50);
    if (acc>intv) { acc=0; if(canFit(piece.s,piece.x,piece.y+1)) piece.y++; else place(); }
    draw(); raf=requestAnimationFrame(loop);
  }
  function startRun() {
    cancelAnimationFrame(raf); board=newBoard(); score=0; lines=0; level=1;
    document.getElementById('tS').textContent='0'; document.getElementById('tL').textContent='0'; document.getElementById('tLv').textContent='1';
    piece=rand(); next=rand(); state='running'; acc=0; last=0; drawNext(); raf=requestAnimationFrame(loop);
  }
  draw(); cvBanner(ctx,W,H,'TETRIS','Classic block stacking game','SPACE to Start');
  const kH = e => {
    if (e.key==='p'||e.key==='P') {
      if(state==='running'){state='paused';cancelAnimationFrame(raf);draw();cvBanner(ctx,W,H,'PAUSED','','P to Resume');}
      else if(state==='paused'){state='running';last=performance.now();raf=requestAnimationFrame(loop);}
      return;
    }
    if (e.code==='Space') { e.preventDefault(); if(state!=='running'){startRun();return;} let d=0; while(canFit(piece.s,piece.x,piece.y+1)){piece.y++;d++;} if(d)place(); draw(); return; }
    if (state!=='running') return;
    if (e.key==='ArrowLeft'&&canFit(piece.s,piece.x-1,piece.y)){piece.x--;draw();}
    else if(e.key==='ArrowRight'&&canFit(piece.s,piece.x+1,piece.y)){piece.x++;draw();}
    else if(e.key==='ArrowDown'&&canFit(piece.s,piece.x,piece.y+1)){piece.y++;draw();}
    else if(e.key==='ArrowUp'||e.key==='z'||e.key==='Z'){const r=rotate(piece.s);if(canFit(r,piece.x,piece.y)){piece.s=r;draw();}}
  };
  window.addEventListener('keydown', kH);
  PAUSE_CBS.tetris = p => { if(p){state='paused';cancelAnimationFrame(raf);draw();cvBanner(ctx,W,H,'PAUSED','','Resume to continue');}else{state='running';last=performance.now();raf=requestAnimationFrame(loop);} };
  CLEANERS.tetris = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLAPPY BIRD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.flappy = function(wrap) {
  const W=360, H=500;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="flCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;cursor:pointer;max-height:80vh"></canvas></div><p style="color:var(--mut);font-size:12px;padding-bottom:8px">Tap / Space to flap</p>`;
  const cv = document.getElementById('flCv'), ctx = cv.getContext('2d');
  const GAP=142, PSP=2.6, GR=0.40, JP=-8, BR=14;
  let bird, pipes, score, best=0, raf, state='idle', fr=0;
  function init() { bird={x:78,y:H/2,vy:0}; pipes=[]; score=0; }
  function addPipe() { const t=55+Math.random()*(H-GAP-110); pipes.push({x:W,top:t,bot:t+GAP,passed:false}); }
  function flap() { if(state==='idle'||state==='dead'){init();state='running';return;} if(state==='paused')return; bird.vy=JP; }
  function drawBird() { ctx.save(); ctx.translate(bird.x,bird.y); ctx.rotate(Math.max(-25,Math.min(50,bird.vy*3))*Math.PI/180); ctx.fillStyle='#e8c46a'; ctx.beginPath(); ctx.ellipse(0,0,BR,BR-3,0,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(6,-4,5,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#222'; ctx.beginPath(); ctx.arc(7,-4,2.5,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#e87030'; ctx.beginPath(); ctx.moveTo(12,-2); ctx.lineTo(20,0); ctx.lineTo(12,3); ctx.closePath(); ctx.fill(); ctx.restore(); }
  function update() {
    bird.vy+=GR; bird.y+=bird.vy;
    if(bird.y+BR>H-52){state='dead';if(score>best)best=score;return;}
    if(bird.y-BR<0){bird.y=BR;bird.vy=0;}
    pipes.forEach(p=>{p.x-=PSP;if(!p.passed&&p.x+48<bird.x){p.passed=true;score++;}if(bird.x+BR>p.x&&bird.x-BR<p.x+48&&(bird.y-BR<p.top||bird.y+BR>p.bot)){state='dead';if(score>best)best=score;}});
    pipes=pipes.filter(p=>p.x>-60);
    if(!pipes.length||pipes[pipes.length-1].x<W-200)addPipe();
  }
  function render() {
    fr++;
    const sky=ctx.createLinearGradient(0,0,0,H); sky.addColorStop(0,'#0a1828'); sky.addColorStop(1,'#162840'); ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);
    pipes.forEach(p=>{ctx.fillStyle='#2a6e2a';ctx.beginPath();ctx.roundRect(p.x,0,48,p.top,3);ctx.fill();ctx.fillStyle='#348034';ctx.fillRect(p.x-4,p.top-20,56,20);ctx.beginPath();ctx.roundRect(p.x,p.bot,48,H-p.bot-52,3);ctx.fill();ctx.fillStyle='#348034';ctx.fillRect(p.x-4,p.bot,56,20);});
    ctx.fillStyle='#3a6e1a'; ctx.fillRect(0,H-52,W,52);
    ctx.textAlign='center'; ctx.font='800 32px Syne,sans-serif'; ctx.fillStyle='rgba(0,0,0,.35)'; ctx.fillText(score,W/2+2,50); ctx.fillStyle='#fff'; ctx.fillText(score,W/2,48);
    if(state==='idle'){ctx.fillStyle='rgba(8,7,4,.8)';ctx.fillRect(0,0,W,H);ctx.font='800 32px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('FLAPPY BIRD',W/2,H/2-48);ctx.font='500 13px DM Sans,sans-serif';ctx.fillStyle='#857d5f';ctx.fillText('Tap or Space to fly',W/2,H/2+4);drawBird();}
    else if(state==='paused'){ctx.fillStyle='rgba(8,7,4,.78)';ctx.fillRect(0,0,W,H);ctx.font='800 30px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('PAUSED',W/2,H/2);}
    else if(state==='dead'){ctx.fillStyle='rgba(8,7,4,.82)';ctx.fillRect(0,0,W,H);ctx.font='800 30px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('GAME OVER',W/2,H/2-52);ctx.font='800 18px Syne,sans-serif';ctx.fillStyle='#c9a84c';ctx.fillText('Score: '+score,W/2,H/2-16);ctx.font='500 13px DM Sans,sans-serif';ctx.fillStyle='#857d5f';ctx.fillText('Best: '+best,W/2,H/2+10);ctx.font='700 13px DM Sans,sans-serif';ctx.fillStyle='#c9a84c';ctx.fillText('Tap or Space to retry',W/2,H/2+44);}
    else drawBird();
    raf=requestAnimationFrame(render);
    if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  const kH = e => { if(e.key==='p'||e.key==='P'){state=state==='paused'?'running':'paused';return;} if(e.code==='Space'){e.preventDefault();flap();} };
  window.addEventListener('keydown', kH);
  cv.addEventListener('click', flap);
  cv.addEventListener('touchstart', e => { e.preventDefault(); flap(); }, {passive:false});
  PAUSE_CBS.flappy = p => { state=p?'paused':'running'; };
  CLEANERS.flappy = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DINO RUN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.dino = function(wrap) {
  const W=660, H=220;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="dS">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="dB">0</div></div></div><div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="dnCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%;cursor:pointer"></canvas></div><p style="color:var(--mut);font-size:12px;padding-bottom:8px">Space / Tap to jump Â· Double jump!</p>`;
  const cv = document.getElementById('dnCv'), ctx = cv.getContext('2d');
  const GND=H-46, GR=0.62, JP=-13;
  let dino, obs, score, best=0, speed, fr, state='idle', raf, jumps, clouds=[];
  function init() { dino={x:68,y:GND,vy:0,w:36,h:46,fr:0}; obs=[]; score=0; speed=5; fr=0; jumps=0; clouds=[{x:200,y:32,w:80},{x:450,y:20,w:60}]; }
  function jump() { if(state==='idle'||state==='dead'){init();state='running';return;} if(state==='paused')return; if(jumps<2){dino.vy=JP;jumps++;} }
  function addObs() { const h=26+Math.random()*36; obs.push({x:W,y:GND+dino.h-h,w:16+Math.random()*14,h}); }
  function drawDino() { const d=dino; ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.roundRect(d.x,d.y,d.w,d.h,5); ctx.fill(); ctx.fillStyle='#e8c46a'; ctx.beginPath(); ctx.roundRect(d.x+d.w-15,d.y-17,25,21,4); ctx.fill(); ctx.fillStyle='#0c0b08'; ctx.beginPath(); ctx.arc(d.x+d.w+3,d.y-9,3,0,Math.PI*2); ctx.fill(); }
  function update() {
    dino.vy+=GR; dino.y+=dino.vy;
    if(dino.y>=GND){dino.y=GND;dino.vy=0;jumps=0;}
    fr++; dino.fr++; speed=5+score*0.004;
    if(fr%Math.max(36,80-score/8)===0)addObs();
    obs.forEach(o=>o.x-=speed);
    obs=obs.filter(o=>o.x>-80);
    clouds.forEach(c=>c.x-=0.7);
    clouds=clouds.filter(c=>c.x>-110);
    if(clouds.length<4)clouds.push({x:W+100,y:14+Math.random()*54,w:50+Math.random()*80});
    score++;
    document.getElementById('dS').textContent=Math.floor(score/5);
    obs.forEach(o=>{if(dino.x+dino.w-8>o.x+4&&dino.x+8<o.x+o.w-4&&dino.y+6<o.y+o.h&&dino.y+dino.h>o.y+4){state='dead';const s=Math.floor(score/5);if(s>best){best=s;document.getElementById('dB').textContent=best;}}});
  }
  function render() {
    ctx.fillStyle='#121110'; ctx.fillRect(0,0,W,H);
    clouds.forEach(c=>{ctx.fillStyle='rgba(255,255,255,.04)';ctx.beginPath();ctx.roundRect(c.x,c.y,c.w,16,8);ctx.fill();});
    ctx.fillStyle='#2a2618'; ctx.fillRect(0,GND+dino.h,W,3);
    obs.forEach(o=>{ctx.fillStyle='#2a6e2a';ctx.beginPath();ctx.roundRect(o.x,o.y,o.w,o.h,2);ctx.fill();});
    if(state!=='idle')drawDino();
    if(state==='idle'){ctx.fillStyle='rgba(8,7,4,.82)';ctx.fillRect(0,0,W,H);ctx.textAlign='center';ctx.font='800 26px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('DINO RUN',W/2,H/2-16);ctx.font='700 12px DM Sans,sans-serif';ctx.fillStyle='#c9a84c';ctx.fillText('Space / Tap to start & jump',W/2,H/2+14);drawDino();}
    else if(state==='paused'){ctx.fillStyle='rgba(8,7,4,.8)';ctx.fillRect(0,0,W,H);ctx.textAlign='center';ctx.font='800 26px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('PAUSED',W/2,H/2-14);}
    else if(state==='dead'){ctx.fillStyle='rgba(8,7,4,.82)';ctx.fillRect(0,0,W,H);ctx.textAlign='center';ctx.font='800 26px Syne,sans-serif';ctx.fillStyle='#e8c46a';ctx.fillText('GAME OVER',W/2,H/2-20);ctx.font='700 12px DM Sans,sans-serif';ctx.fillStyle='#857d5f';ctx.fillText('Space / Tap to retry',W/2,H/2+32);}
    raf=requestAnimationFrame(render);
    if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  const kH = e => { if(e.key==='p'||e.key==='P'){state=state==='paused'?'running':'paused';return;} if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault();jump();} };
  window.addEventListener('keydown', kH);
  cv.addEventListener('click', jump);
  cv.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});
  PAUSE_CBS.dino = p => { state=p?'paused':'running'; };
  CLEANERS.dino = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPACE SHOOTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.spaceshoot = function(wrap) {
  const W=500, H=560;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="ssS">0</div></div><div class="hb"><div class="hl">Lives</div><div class="hv" id="ssLv">â¤ï¸â¤ï¸â¤ï¸</div></div><div class="hb"><div class="hl">Wave</div><div class="hv" id="ssW">1</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="ssCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-height:72vh"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">â† â†’ / WASD Â· Space=shoot Â· P=Pause</p>`;
  const cv = document.getElementById('ssCv'), ctx = cv.getContext('2d');
  let ship, bullets, enemies, eBullets, score, lives, wave, stars, raf, state='idle', shootCool, fr;
  function mkStars() { stars=Array.from({length:80},()=>({x:Math.random()*W,y:Math.random()*H,s:Math.random()*1.5+.5,sp:Math.random()+.4})); }
  function spawnEnemies(w) { enemies=[]; const rows=Math.min(3+w,5),cols=Math.min(6+w,10); for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)enemies.push({x:40+c*44,y:30+r*36,w:28,h:22,hp:r<2?1:2,type:r,vx:.8+w*.2,vy:0}); }
  function init() { ship={x:W/2-18,y:H-60,w:36,h:28,vx:0}; bullets=[]; eBullets=[]; score=0; lives=3; wave=1; shootCool=0; fr=0; mkStars(); spawnEnemies(1); document.getElementById('ssS').textContent='0'; document.getElementById('ssLv').textContent='â¤ï¸â¤ï¸â¤ï¸'; document.getElementById('ssW').textContent='1'; }
  const keys = {};
  const kH = e => { keys[e.key]=e.type==='keydown'; };
  window.addEventListener('keydown', kH); window.addEventListener('keyup', kH);
  function drawShip(x,y) { ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.moveTo(x+18,y); ctx.lineTo(x+36,y+28); ctx.lineTo(x+26,y+22); ctx.lineTo(x+18,y+28); ctx.lineTo(x+10,y+22); ctx.lineTo(x,y+28); ctx.closePath(); ctx.fill(); ctx.fillStyle='#e8c46a'; ctx.beginPath(); ctx.moveTo(x+18,y+4); ctx.lineTo(x+24,y+18); ctx.lineTo(x+18,y+14); ctx.lineTo(x+12,y+18); ctx.closePath(); ctx.fill(); }
  function drawEnemy(e) { const colors=['#e84040','#e87030','#50c850','#4080e0','#a050e8']; ctx.fillStyle=colors[e.type%colors.length]; ctx.beginPath(); ctx.ellipse(e.x+14,e.y+11,14,11,0,0,Math.PI*2); ctx.fill(); }
  function update() {
    fr++;
    const spd=5;
    if((keys['ArrowLeft']||keys['a']||keys['A'])&&ship.x>0)ship.x-=spd;
    if((keys['ArrowRight']||keys['d']||keys['D'])&&ship.x<W-ship.w)ship.x+=spd;
    shootCool--;
    if((keys[' ']||keys['Space'])&&shootCool<=0){bullets.push({x:ship.x+ship.w/2,y:ship.y,vy:-10});shootCool=18;}
    stars.forEach(s=>{s.y+=s.sp;if(s.y>H){s.y=0;s.x=Math.random()*W;}});
    bullets.forEach(b=>b.y+=b.vy); bullets=bullets.filter(b=>b.y>-10);
    let hitWall=false;
    enemies.forEach(e=>{e.x+=e.vx;if(e.x<0||e.x+e.w>W)hitWall=true;});
    if(hitWall){enemies.forEach(e=>{e.vx*=-1;e.y+=20;});if(enemies.some(e=>e.y+e.h>H-80)){lives=0;}}
    if(fr%60===0&&enemies.length){const sh=enemies[Math.floor(Math.random()*enemies.length)];eBullets.push({x:sh.x+14,y:sh.y+22,vy:4+wave*.5});}
    eBullets.forEach(b=>b.y+=b.vy); eBullets=eBullets.filter(b=>b.y<H+10);
    bullets.forEach(b=>{enemies.forEach(e=>{if(!e.dead&&b.x>e.x&&b.x<e.x+e.w&&b.y>e.y&&b.y<e.y+e.h){e.hp--;b.dead=true;if(e.hp<=0){e.dead=true;score+=150;document.getElementById('ssS').textContent=score;}}});});
    bullets=bullets.filter(b=>!b.dead); enemies=enemies.filter(e=>!e.dead);
    eBullets.forEach(b=>{if(b.x>ship.x&&b.x<ship.x+ship.w&&b.y>ship.y&&b.y<ship.y+ship.h){b.dead=true;lives--;document.getElementById('ssLv').textContent='â¤ï¸'.repeat(Math.max(0,lives))||'ğŸ’€';if(lives<=0){state='gameover';}}});
    eBullets=eBullets.filter(b=>!b.dead);
    if(!enemies.length){wave++;document.getElementById('ssW').textContent=wave;spawnEnemies(wave);}
    if(lives<=0)state='gameover';
  }
  function render() {
    ctx.fillStyle='#050810'; ctx.fillRect(0,0,W,H);
    stars.forEach(s=>{ctx.fillStyle=`rgba(255,255,255,${s.s*.5})`;ctx.fillRect(s.x,s.y,s.s,s.s);});
    enemies.forEach(drawEnemy);
    bullets.forEach(b=>{ctx.fillStyle='#c9a84c';ctx.shadowColor='#c9a84c';ctx.shadowBlur=8;ctx.fillRect(b.x-2,b.y-8,4,12);ctx.shadowBlur=0;});
    eBullets.forEach(b=>{ctx.fillStyle='#e84040';ctx.shadowColor='#e84040';ctx.shadowBlur=6;ctx.fillRect(b.x-2,b.y,4,10);ctx.shadowBlur=0;});
    if(state!=='idle')drawShip(ship.x,ship.y);
    if(state==='idle')cvBanner(ctx,W,H,'SPACE SHOOTER','Destroy all alien waves!','SPACE to Start Â· Arrows/WASD');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','Resume to continue');
    else if(state==='gameover')cvBanner(ctx,W,H,'GAME OVER','Score: '+score+' Â· Wave: '+wave,'SPACE to Play Again');
    raf=requestAnimationFrame(render);
    if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  const spH = e => {
    if(e.code==='Space'&&state!=='running'){e.preventDefault();if(state==='idle'||state==='gameover'){init();state='running';}}
    if((e.key==='p'||e.key==='P')&&(state==='running'||state==='paused')){state=state==='paused'?'running':'paused';}
  };
  window.addEventListener('keydown', spH);
  PAUSE_CBS.spaceshoot = p => { state=p?'paused':'running'; };
  CLEANERS.spaceshoot = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown',kH); window.removeEventListener('keyup',kH); window.removeEventListener('keydown',spH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACTION TIME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.reaction = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center;justify-content:center;gap:0';
  wrap.innerHTML = `<div class="hud-row" style="margin-bottom:12px"><div class="hb"><div class="hl">Best</div><div class="hv" id="rtB">â€”</div></div><div class="hb"><div class="hl">Last</div><div class="hv" id="rtL">â€”</div></div><div class="hb"><div class="hl">Round</div><div class="hv" id="rtR">0</div></div></div>
  <div id="rtBox" style="width:min(420px,90vw);height:280px;border-radius:18px;border:2px solid var(--bord2);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:background .2s;background:var(--surf);user-select:none">
    <div id="rtEmoji" style="font-size:64px;margin-bottom:12px">ğŸ‘€</div>
    <div id="rtMsg" style="font-family:var(--font-head);font-size:22px;font-weight:700;color:var(--mut);text-align:center;padding:0 20px">Click to Start</div>
    <div id="rtSub" style="font-size:13px;color:var(--mut2);margin-top:8px;text-align:center">Wait for GREEN then click!</div>
  </div>
  <p style="color:var(--mut);font-size:12px;padding-top:14px;padding-bottom:8px">Click or Space when it turns green!</p>`;
  let state='idle', startT, timer, round=0, best=Infinity;
  const box = document.getElementById('rtBox');
  function setIdle() { box.style.background='var(--surf)'; document.getElementById('rtEmoji').textContent='ğŸ‘€'; document.getElementById('rtMsg').textContent='Click to Start'; document.getElementById('rtMsg').style.color='var(--mut)'; document.getElementById('rtSub').textContent='Wait for green, then click!'; state='idle'; }
  function startWait() {
    state='wait'; box.style.background='var(--surf2)'; document.getElementById('rtEmoji').textContent='â³'; document.getElementById('rtMsg').textContent='Wait for it...'; document.getElementById('rtMsg').style.color='var(--mut)'; document.getElementById('rtSub').textContent='';
    const delay=1200+Math.random()*3800;
    timer=setTimeout(()=>{state='go';startT=Date.now();box.style.background='#1a4a1a';document.getElementById('rtEmoji').textContent='ğŸŸ¢';document.getElementById('rtMsg').textContent='CLICK NOW!';document.getElementById('rtMsg').style.color='#50c850';},delay);
  }
  function onClick() {
    if(state==='idle')startWait();
    else if(state==='wait'){clearTimeout(timer);box.style.background='#4a1010';document.getElementById('rtEmoji').textContent='âŒ';document.getElementById('rtMsg').textContent='Too early!';document.getElementById('rtMsg').style.color='#e84040';document.getElementById('rtSub').textContent='Click to try again';state='early';}
    else if(state==='go'){const rt=Date.now()-startT;if(rt<best)best=rt;round++;document.getElementById('rtB').textContent=best+'ms';document.getElementById('rtL').textContent=rt+'ms';document.getElementById('rtR').textContent=round;box.style.background='var(--surf)';document.getElementById('rtEmoji').textContent=rt<200?'ğŸš€':rt<300?'âš¡':rt<500?'ğŸ‘':'ğŸ¢';document.getElementById('rtMsg').textContent=rt+'ms';document.getElementById('rtMsg').style.color='#e8c46a';document.getElementById('rtSub').textContent=rt<200?'Lightning fast!':rt<300?'Excellent!':rt<500?'Good!':'Keep practicing!';state='result';}
    else if(state==='result'||state==='early')startWait();
  }
  box.addEventListener('click', onClick);
  const kH = e => { if(e.code==='Space'){e.preventDefault();onClick();} };
  window.addEventListener('keydown', kH);
  CLEANERS.reaction = () => { clearTimeout(timer); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AIM TRAINER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.aim = function(wrap) {
  const W=600, H=440;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="atS">0</div></div><div class="hb"><div class="hl">Accuracy</div><div class="hv" id="atA">â€”</div></div><div class="hb"><div class="hl">Time</div><div class="hv" id="atT">30</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="atB">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="atCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;cursor:crosshair;max-width:100%"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Click the targets as fast as you can!</p>`;
  const cv = document.getElementById('atCv'), ctx = cv.getContext('2d');
  let targets, score, clicks, hits, timeLeft, timer, state='idle', best=0, raf;
  function spawnTarget() { const r=20+Math.random()*20; return {x:r+Math.random()*(W-r*2),y:r+Math.random()*(H-r*2),r,life:100,maxLife:100}; }
  function init() { targets=[spawnTarget()]; score=0; clicks=0; hits=0; timeLeft=30; clearInterval(timer); timer=setInterval(()=>{timeLeft--;document.getElementById('atT').textContent=timeLeft;if(timeLeft<=0){state='done';clearInterval(timer);if(score>best)best=score;}},1000); }
  function render() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    targets.forEach(t=>{const a=t.life/t.maxLife;ctx.fillStyle=`rgba(232,64,64,${a})`;ctx.shadowColor='#e84040';ctx.shadowBlur=14*a;ctx.beginPath();ctx.arc(t.x,t.y,t.r,0,Math.PI*2);ctx.fill();ctx.fillStyle='rgba(255,255,255,.3)';ctx.beginPath();ctx.arc(t.x,t.y,t.r*.4,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;t.life--;});
    targets=targets.filter(t=>t.life>0);
    if(targets.length<3)targets.push(spawnTarget());
    if(state==='idle')cvBanner(ctx,W,H,'AIM TRAINER','30 seconds Â· Click targets!','Click to Start');
    else if(state==='done')cvBanner(ctx,W,H,'TIME\'S UP!','Score: '+score+' Â· Accuracy: '+(clicks?Math.round(hits/clicks*100):0)+'%','Click to Play Again');
    raf=requestAnimationFrame(render);
  }
  raf=requestAnimationFrame(render);
  cv.addEventListener('click', e => {
    if(state==='idle'){state='running';init();return;}
    if(state==='done'){state='idle';return;}
    clicks++; const r=cv.getBoundingClientRect(); const mx=(e.clientX-r.left)*(W/r.width),my=(e.clientY-r.top)*(H/r.height);
    let hit=false;
    targets.forEach((t,i)=>{if(Math.hypot(mx-t.x,my-t.y)<t.r){hits++;score+=Math.ceil(t.r);document.getElementById('atS').textContent=score;targets.splice(i,1);targets.push(spawnTarget());hit=true;}});
    document.getElementById('atA').textContent=(clicks?Math.round(hits/clicks*100):0)+'%';
    document.getElementById('atB').textContent=Math.max(best,score);
  });
  CLEANERS.aim = () => { clearInterval(timer); cancelAnimationFrame(raf); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WHACK-A-MOLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.whack = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center;justify-content:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="wmS">0</div></div><div class="hb"><div class="hl">Misses</div><div class="hv" id="wmM">0</div></div><div class="hb"><div class="hl">Time</div><div class="hv" id="wmT">30</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="wmB">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px">
    <div style="display:flex;flex-direction:column;align-items:center;gap:16px">
      <div id="wmGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px"></div>
      <button class="btn-gold" id="wmStart" onclick="window._wmN()">Start Game</button>
    </div>
  </div>`;
  const HOLES = 9;
  let holes, score, misses, timeLeft, gameTimer, moleTimer, state='idle', best=0;
  function buildGrid() {
    const grid = document.getElementById('wmGrid');
    grid.innerHTML = '';
    holes = [];
    for (let i=0; i<HOLES; i++) {
      const hole = document.createElement('div');
      hole.style.cssText = `width:90px;height:90px;border-radius:50%;background:var(--surf2);border:3px solid var(--bord2);display:flex;align-items:center;justify-content:center;font-size:40px;cursor:pointer;transition:all .12s;user-select:none;position:relative;overflow:hidden;`;
      hole.dataset.idx = i;
      hole.textContent = 'ğŸ•³ï¸';
      hole.addEventListener('click', () => whackHole(i));
      grid.appendChild(hole);
      holes.push({el:hole, active:false, timer:null});
    }
  }
  function whackHole(i) {
    if (state!=='running') return;
    const h = holes[i];
    if (h.active) {
      h.active = false; clearTimeout(h.timer);
      h.el.textContent = 'ğŸ’¥'; h.el.style.background = 'rgba(232,196,74,.2)'; h.el.style.borderColor = 'var(--gold)';
      score += 10; document.getElementById('wmS').textContent = score;
      setTimeout(() => { h.el.textContent = 'ğŸ•³ï¸'; h.el.style.background = 'var(--surf2)'; h.el.style.borderColor = 'var(--bord2)'; }, 300);
    } else {
      misses++; document.getElementById('wmM').textContent = misses;
      h.el.style.background = 'rgba(232,64,64,.2)';
      setTimeout(() => h.el.style.background = 'var(--surf2)', 200);
    }
  }
  function showMole() {
    if (state !== 'running') return;
    const available = holes.filter(h => !h.active);
    if (!available.length) return;
    const h = available[Math.floor(Math.random() * available.length)];
    h.active = true;
    h.el.textContent = 'ğŸ¹'; h.el.style.background = 'rgba(80,200,80,.15)'; h.el.style.borderColor = '#50c850';
    const delay = Math.max(600, 1400 - score * 8);
    h.timer = setTimeout(() => {
      if (h.active) {
        h.active = false;
        h.el.textContent = 'ğŸ•³ï¸'; h.el.style.background = 'var(--surf2)'; h.el.style.borderColor = 'var(--bord2)';
      }
    }, delay);
  }
  function startGame() {
    state = 'running'; score = 0; misses = 0; timeLeft = 30;
    document.getElementById('wmS').textContent = '0';
    document.getElementById('wmM').textContent = '0';
    document.getElementById('wmT').textContent = '30';
    document.getElementById('wmStart').style.display = 'none';
    buildGrid();
    gameTimer = setInterval(() => {
      timeLeft--;
      document.getElementById('wmT').textContent = timeLeft;
      if (timeLeft <= 0) {
        state = 'done'; clearInterval(gameTimer); clearInterval(moleTimer);
        holes.forEach(h => { clearTimeout(h.timer); h.el.textContent = 'ğŸ•³ï¸'; });
        if (score > best) best = score;
        document.getElementById('wmB').textContent = best;
        document.getElementById('wmStart').textContent = 'Play Again';
        document.getElementById('wmStart').style.display = '';
      }
    }, 1000);
    moleTimer = setInterval(showMole, 700);
  }
  window._wmN = () => { clearInterval(gameTimer); clearInterval(moleTimer); startGame(); };
  buildGrid();
  CLEANERS.whack = () => { clearInterval(gameTimer); clearInterval(moleTimer); delete window._wmN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMON SAYS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.simon = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center;justify-content:center;gap:0';
  wrap.innerHTML = `<div class="hud-row" style="margin-bottom:16px"><div class="hb"><div class="hl">Round</div><div class="hv" id="siR">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="siB">0</div></div><div class="hb"><div class="hl">Status</div><div class="hv" id="siSt">Ready</div></div></div>
  <div style="position:relative;width:260px;height:260px;margin:0 auto">
    <div id="siBtn0" style="position:absolute;top:0;left:0;width:120px;height:120px;border-radius:20px 60px 20px 20px;background:#1a4a1a;border:3px solid #2a6a2a;cursor:pointer;transition:background .12s;display:flex;align-items:center;justify-content:center;font-size:28px">ğŸŸ¢</div>
    <div id="siBtn1" style="position:absolute;top:0;right:0;width:120px;height:120px;border-radius:60px 20px 20px 20px;background:#4a1a1a;border:3px solid #6a2a2a;cursor:pointer;transition:background .12s;display:flex;align-items:center;justify-content:center;font-size:28px">ğŸ”´</div>
    <div id="siBtn2" style="position:absolute;bottom:0;left:0;width:120px;height:120px;border-radius:20px 20px 20px 60px;background:#1a1a4a;border:3px solid #2a2a6a;cursor:pointer;transition:background .12s;display:flex;align-items:center;justify-content:center;font-size:28px">ğŸ”µ</div>
    <div id="siBtn3" style="position:absolute;bottom:0;right:0;width:120px;height:120px;border-radius:20px 20px 60px 20px;background:#4a3a1a;border:3px solid #6a5a2a;cursor:pointer;transition:background .12s;display:flex;align-items:center;justify-content:center;font-size:28px">ğŸŸ¡</div>
  </div>
  <div id="siMsg" style="font-family:var(--font-head);font-size:16px;font-weight:700;color:var(--mut);margin-top:20px;text-align:center;min-height:24px"></div>
  <button class="btn-gold" id="siStart" onclick="window._siN()" style="margin-top:16px;padding:10px 28px">Start Game</button>`;

  const COLORS = [
    {bg:'#1a4a1a', lit:'#50c850', border:'#2a6a2a'},
    {bg:'#4a1a1a', lit:'#e84040', border:'#6a2a2a'},
    {bg:'#1a1a4a', lit:'#4080e0', border:'#2a2a6a'},
    {bg:'#4a3a1a', lit:'#e8c46a', border:'#6a5a2a'},
  ];
  let sequence = [], playerIdx, round, best=0, state='idle', playing=false;

  function flash(idx, dur=350) {
    return new Promise(res => {
      const btn = document.getElementById('siBtn'+idx);
      btn.style.background = COLORS[idx].lit;
      btn.style.borderColor = COLORS[idx].lit;
      setTimeout(() => {
        btn.style.background = COLORS[idx].bg;
        btn.style.borderColor = COLORS[idx].border;
        setTimeout(res, 120);
      }, dur);
    });
  }

  async function playSequence() {
    playing = true;
    document.getElementById('siSt').textContent = 'Watch!';
    document.getElementById('siMsg').textContent = 'Remember the sequence...';
    await new Promise(r => setTimeout(r, 600));
    for (const c of sequence) {
      await flash(c, 400);
      await new Promise(r => setTimeout(r, 80));
    }
    playing = false;
    playerIdx = 0;
    document.getElementById('siSt').textContent = 'Your turn!';
    document.getElementById('siMsg').textContent = 'Repeat the sequence: ' + sequence.length + ' step(s)';
  }

  async function nextRound() {
    sequence.push(Math.floor(Math.random()*4));
    round = sequence.length;
    document.getElementById('siR').textContent = round;
    await playSequence();
  }

  function playerClick(idx) {
    if (state !== 'running' || playing) return;
    flash(idx, 220);
    if (sequence[playerIdx] === idx) {
      playerIdx++;
      if (playerIdx === sequence.length) {
        if (round > best) { best = round; document.getElementById('siB').textContent = best; }
        document.getElementById('siSt').textContent = 'âœ… Correct!';
        setTimeout(() => nextRound(), 900);
      }
    } else {
      state = 'gameover';
      document.getElementById('siSt').textContent = 'âŒ Wrong!';
      document.getElementById('siMsg').textContent = 'Game over! Round: ' + round + ' Â· Best: ' + best;
      document.getElementById('siStart').textContent = 'Play Again';
      document.getElementById('siStart').style.display = '';
    }
  }

  function startGame() {
    state = 'running'; sequence = []; round = 0;
    document.getElementById('siStart').style.display = 'none';
    document.getElementById('siMsg').textContent = '';
    document.getElementById('siR').textContent = '0';
    nextRound();
  }

  for (let i=0; i<4; i++) {
    document.getElementById('siBtn'+i).addEventListener('click', () => playerClick(i));
  }
  window._siN = startGame;
  CLEANERS.simon = () => { delete window._siN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUDOKU
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.sudoku = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Errors</div><div class="hv" id="sdE">0</div></div><div class="hb"><div class="hl">â±</div><div class="hv" id="sdT">0:00</div></div><div class="hb"><div class="hl">Status</div><div class="hv" id="sdSt">Playing</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative">
    <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
      <div id="sdGrid" style="display:grid;grid-template-columns:repeat(9,1fr);gap:2px;background:#363220;padding:2px;border-radius:8px;border:2px solid var(--gold4)"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
        ${[1,2,3,4,5,6,7,8,9].map(n=>`<button onclick="window._sdN(${n})" style="width:36px;height:36px;background:var(--surf);border:1px solid var(--bord2);border-radius:8px;color:var(--gold2);font-family:var(--font-head);font-size:16px;font-weight:700;cursor:pointer">${n}</button>`).join('')}
        <button onclick="window._sdN(0)" style="width:36px;height:36px;background:var(--surf);border:1px solid var(--bord2);border-radius:8px;color:var(--mut);font-family:var(--font-head);font-size:14px;cursor:pointer">âœ•</button>
      </div>
      <button class="btn-gold" onclick="window._sdNew()" style="padding:9px 24px;font-size:13px">New Puzzle</button>
    </div>
  </div>`;

  let puzzle, solution, given, selected, errors, startTime, timer;

  const BASE_PUZZLES = [
    '530070000600195000098000060800060003400803001700020006060000280000419005000080079',
    '003020600900305001001806400008102900700000008006708200002609500800203009005010300',
    '200080300060070084030500209000105408000000000402706000301007040720040060004010003',
    '000000907000420180000705026100904000050000040000507009920108000034059000507000000',
  ];

  function parsePuzzle(s) {
    return s.split('').map(c => parseInt(c));
  }

  function solveSudoku(board) {
    const b = [...board];
    function isValid(b, pos, num) {
      const row = Math.floor(pos/9), col = pos%9;
      for (let i=0; i<9; i++) {
        if (b[row*9+i]===num) return false;
        if (b[i*9+col]===num) return false;
        const br=3*Math.floor(row/3)+Math.floor(i/3), bc=3*Math.floor(col/3)+i%3;
        if (b[br*9+bc]===num) return false;
      }
      return true;
    }
    function solve(b) {
      const empty = b.indexOf(0);
      if (empty===-1) return true;
      for (let n=1; n<=9; n++) {
        if (isValid(b,empty,n)) { b[empty]=n; if(solve(b))return true; b[empty]=0; }
      }
      return false;
    }
    solve(b); return b;
  }

  function newPuzzle() {
    clearInterval(timer);
    const src = BASE_PUZZLES[Math.floor(Math.random()*BASE_PUZZLES.length)];
    puzzle = parsePuzzle(src);
    given = puzzle.map(v => v !== 0);
    solution = solveSudoku([...puzzle]);
    selected = -1; errors = 0;
    document.getElementById('sdE').textContent = '0';
    document.getElementById('sdSt').textContent = 'Playing';
    startTime = Date.now();
    timer = setInterval(() => {
      const s = Math.floor((Date.now()-startTime)/1000);
      document.getElementById('sdT').textContent = Math.floor(s/60)+':'+(s%60<10?'0':'')+(s%60);
    }, 1000);
    render();
  }

  function render() {
    const grid = document.getElementById('sdGrid');
    grid.innerHTML = '';
    for (let i=0; i<81; i++) {
      const cell = document.createElement('div');
      const row = Math.floor(i/9), col = i%9;
      const boxR = Math.floor(row/3), boxC = Math.floor(col/3);
      const darken = (boxR+boxC)%2===0;
      const isSelected = i===selected;
      const sameBox = selected>=0 && Math.floor(Math.floor(selected/9)/3)===boxR && Math.floor((selected%9)/3)===boxC;
      const sameRow = selected>=0 && Math.floor(selected/9)===row;
      const sameCol = selected>=0 && selected%9===col;
      const isSame = puzzle[i]>0 && selected>=0 && puzzle[i]===puzzle[selected] && !isSelected;
      cell.style.cssText = `width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-family:var(--font-head);font-size:${puzzle[i]?'18':'14'}px;font-weight:700;cursor:pointer;border-radius:4px;transition:background .1s;border-right:${col===2||col===5?'2px solid var(--gold4)':'1px solid #2a2618'};border-bottom:${row===2||row===5?'2px solid var(--gold4)':'1px solid #2a2618'};`;
      if (isSelected) cell.style.background = 'rgba(201,168,76,.35)';
      else if (isSame) cell.style.background = 'rgba(201,168,76,.18)';
      else if (sameRow||sameCol||sameBox) cell.style.background = darken?'#1a1810':'#161410';
      else cell.style.background = darken?'#151310':'#121008';
      if (given[i]) { cell.style.color = 'var(--txt)'; cell.textContent = puzzle[i]; }
      else if (puzzle[i]) {
        const correct = puzzle[i]===solution[i];
        cell.style.color = correct ? 'var(--gold2)' : '#e84040';
        cell.textContent = puzzle[i];
      }
      cell.addEventListener('click', () => { selected=i; render(); });
      grid.appendChild(cell);
    }
  }

  window._sdN = (n) => {
    if (selected<0 || given[selected]) return;
    if (n===0) { puzzle[selected]=0; }
    else {
      if (n!==solution[selected]) { errors++; document.getElementById('sdE').textContent=errors; }
      puzzle[selected]=n;
      if (puzzle.every((v,i)=>v===solution[i])) {
        clearInterval(timer);
        document.getElementById('sdSt').textContent='ğŸ† Solved!';
      }
    }
    render();
  };

  window._sdNew = newPuzzle;
  newPuzzle();
  CLEANERS.sudoku = () => { clearInterval(timer); delete window._sdN; delete window._sdNew; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RHYTHM TAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.rhythm = function(wrap) {
  const W=400, H=500;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="rhS">0</div></div><div class="hb"><div class="hl">Combo</div><div class="hv" id="rhC">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="rhB">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="rhCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-height:75vh"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Press D F J K or tap lanes!</p>`;
  const cv = document.getElementById('rhCv'), ctx = cv.getContext('2d');
  const LANES=4, LW=W/LANES, KEYS=['d','f','j','k'], COLS=['#e84040','#e8c46a','#4080e0','#50c850'];
  const HIT_Y=H-70, NOTE_SPD=4;
  let notes, score, combo, best=0, raf, state='idle', fr, effects;
  function init() { notes=[]; score=0; combo=0; fr=0; effects=[]; }
  function hitLane(lane) {
    const close = notes.filter(n => !n.hit && n.lane===lane && Math.abs(n.y-HIT_Y)<44);
    if (close.length) {
      close[0].hit=true; combo++; const pts=100+combo*10; score+=pts;
      document.getElementById('rhS').textContent=score; document.getElementById('rhC').textContent=combo;
      if(score>best){best=score;document.getElementById('rhB').textContent=best;}
      effects.push({lane,txt:'+'+pts,life:30,y:HIT_Y-30});
    } else {
      combo=0; document.getElementById('rhC').textContent='0';
      effects.push({lane,txt:'MISS',life:25,y:HIT_Y-30,miss:true});
    }
  }
  let noteInterval;
  function startSpawning() { noteInterval=setInterval(()=>{if(state==='running'){const lane=Math.floor(Math.random()*LANES);notes.push({lane,y:-20,hit:false});}},600); }
  function render() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    for(let i=0;i<LANES;i++){ctx.fillStyle=`rgba(${i===0?'232,64,64':i===1?'232,196,74':i===2?'64,128,224':'80,200,80'},.06)`;ctx.fillRect(i*LW,0,LW,H);}
    for(let i=0;i<LANES;i++){ctx.fillStyle=`rgba(${i===0?'232,64,64':i===1?'232,196,74':i===2?'64,128,224':'80,200,80'},.25)`;ctx.beginPath();ctx.roundRect(i*LW+8,HIT_Y-16,LW-16,32,8);ctx.fill();ctx.font='700 13px DM Sans,sans-serif';ctx.fillStyle='rgba(255,255,255,.3)';ctx.textAlign='center';ctx.fillText(KEYS[i].toUpperCase(),i*LW+LW/2,HIT_Y+6);}
    notes.forEach(n=>{if(n.hit)return;const col=COLS[n.lane];ctx.fillStyle=col;ctx.shadowColor=col;ctx.shadowBlur=12;ctx.beginPath();ctx.roundRect(n.lane*LW+6,n.y-16,LW-12,32,8);ctx.fill();ctx.shadowBlur=0;n.y+=NOTE_SPD;if(n.y>HIT_Y+60){n.hit=true;combo=0;document.getElementById('rhC').textContent='0';}});
    effects.forEach(ef=>{ctx.font=`700 ${ef.miss?16:14}px DM Sans,sans-serif`;ctx.fillStyle=ef.miss?'#e84040':'#e8c46a';ctx.textAlign='center';ctx.fillText(ef.txt,ef.lane*LW+LW/2,ef.y);ef.y-=1;ef.life--;});
    effects=effects.filter(ef=>ef.life>0);
    if(state==='idle')cvBanner(ctx,W,H,'RHYTHM TAP','Press D F J K to hit notes!','SPACE to Start');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','P to Resume');
    fr++; raf=requestAnimationFrame(render);
  }
  raf=requestAnimationFrame(render);
  const kH = e => {
    if(e.code==='Space'){if(state!=='running'){init();state='running';startSpawning();}return;}
    if(e.key==='p'||e.key==='P'){if(state==='running')state='paused';else if(state==='paused')state='running';return;}
    const idx=KEYS.indexOf(e.key.toLowerCase());if(idx!==-1&&state==='running')hitLane(idx);
  };
  window.addEventListener('keydown', kH);
  cv.addEventListener('click', e => {
    if(state!=='running'){init();state='running';startSpawning();return;}
    const r=cv.getBoundingClientRect();const mx=(e.clientX-r.left)*(W/r.width);hitLane(Math.floor(mx/LW));
  });
  PAUSE_CBS.rhythm = p => { state=p?'paused':'running'; };
  CLEANERS.rhythm = () => { cancelAnimationFrame(raf); clearInterval(noteInterval); window.removeEventListener('keydown', kH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROAD RACER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.racing3d = function(wrap) {
  const W=500, H=440;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Speed</div><div class="hv" id="rrSp">0</div></div><div class="hb"><div class="hl">Score</div><div class="hv" id="rrS">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="rrB">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="rrCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">â† â†’ / A D to steer Â· Space=accelerate</p>`;
  const cv = document.getElementById('rrCv'), ctx = cv.getContext('2d');
  const SEGS=150, SEG_LEN=200, CAM_H=1000;
  let road, camZ, playerX, speed, score, best=0, state='idle', raf, fr;
  const keys = {};
  const kH2 = e => { keys[e.key]=e.type==='keydown'; };
  window.addEventListener('keydown', kH2); window.addEventListener('keyup', kH2);
  function mkRoad() { road=Array.from({length:SEGS},(_,i)=>({curve:Math.sin(i/10)*(i%30<15?.5:-.5)*1.5})); }
  function init() { camZ=0; playerX=0; speed=0; score=0; fr=0; mkRoad(); }
  function project(x, z) { const dz=z-camZ; if(dz<=0)return null; const scale=CAM_H/(dz*.1); const sx=W/2+(x-playerX)*scale; const sy=H/2; return {sx,sy,scale}; }
  function render() {
    ctx.fillStyle='#1a3060'; ctx.fillRect(0,0,W,H/2+20);
    ctx.fillStyle='#2a6e2a'; ctx.fillRect(0,H/2+20,W,H/2-20);
    const startSeg=Math.floor(camZ/SEG_LEN)%SEGS;
    let curveAcc=0;
    for(let i=80;i>0;i--){
      const segIdx=(startSeg+i)%SEGS;const seg=road[segIdx];
      const z=camZ+(i-1)*SEG_LEN; const z2=camZ+i*SEG_LEN;
      const p1=project(curveAcc,z); const p2=project(curveAcc+seg.curve*.5,z2);
      curveAcc+=seg.curve*.5;
      if(!p1||!p2)continue;
      const stripe=Math.floor(z/SEG_LEN)%2;
      ctx.fillStyle=stripe?'#888':'#aaa';
      ctx.beginPath();ctx.moveTo(p2.sx-40*p2.scale,p2.sy);ctx.lineTo(p2.sx+40*p2.scale,p2.sy);ctx.lineTo(p1.sx+40*p1.scale,p1.sy);ctx.lineTo(p1.sx-40*p1.scale,p1.sy);ctx.closePath();ctx.fill();
    }
    ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.roundRect(W/2-24,H-90,48,36,5); ctx.fill();
    ctx.fillStyle='#e8c46a'; ctx.beginPath(); ctx.roundRect(W/2-18,H-108,36,22,4); ctx.fill();
    if(state==='idle')cvBanner(ctx,W,H,'ROAD RACER','Dodge traffic â€” OutRun style!','SPACE to Start Â· Arrows/AD to steer');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','P to Resume');
    raf=requestAnimationFrame(render);
    if(state==='running'){
      fr++;
      if(keys['ArrowLeft']||keys['a']||keys['A'])playerX-=0.02*speed;
      if(keys['ArrowRight']||keys['d']||keys['D'])playerX+=0.02*speed;
      if(keys[' ']||keys['Space'])speed=Math.min(speed+.08,4);else speed=Math.max(speed-.04,0.5);
      camZ+=speed*SEG_LEN*.05; score+=Math.floor(speed);
      document.getElementById('rrSp').textContent=Math.floor(speed*20);
      document.getElementById('rrS').textContent=score;
      if(score>best){best=score;document.getElementById('rrB').textContent=best;}
      playerX=Math.max(-.9,Math.min(.9,playerX));
    }
  }
  raf=requestAnimationFrame(render);
  const spH2 = e => {
    if(e.code==='Space'&&state!=='running'){e.preventDefault();init();state='running';}
    if((e.key==='p'||e.key==='P')&&(state==='running'||state==='paused')){state=state==='paused'?'running':'paused';}
  };
  window.addEventListener('keydown', spH2);
  PAUSE_CBS.racing3d = p => { state=p?'paused':'running'; };
  CLEANERS.racing3d = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown',kH2); window.removeEventListener('keyup',kH2); window.removeEventListener('keydown',spH2); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STREET FIGHTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.fighter = function(wrap) {
  const W=600, H=360;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb" style="flex:1"><div class="hl">ğŸ”´ Player 1</div><div style="width:100%;background:var(--bord);border-radius:4px;height:12px;margin:4px 0"><div id="hp1bar" style="height:12px;border-radius:4px;background:#e84040;width:100%;transition:width .1s"></div></div></div><div class="hb"><div class="hl">Round</div><div class="hv" id="ftR">1</div></div><div class="hb" style="flex:1"><div class="hl" style="text-align:right">Player 2 ğŸ”µ</div><div style="width:100%;background:var(--bord);border-radius:4px;height:12px;margin:4px 0"><div id="hp2bar" style="height:12px;border-radius:4px;background:#4080e0;width:100%;transition:width .1s"></div></div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="ftCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">P1: WASD+F(punch)G(kick) Â· P2: Arrows+L(punch)K(kick)</p>`;
  const cv = document.getElementById('ftCv'), ctx = cv.getContext('2d');
  const GND=H-60;
  let p1, p2, state='idle', raf, fr, w1=0, w2=0, round=1, effects=[];
  const keys = {};
  const kH = e => { keys[e.key]=e.type==='keydown'; };
  window.addEventListener('keydown', kH); window.addEventListener('keyup', kH);
  function mkFighter(x,col,flip) { return {x,y:GND-80,w:40,h:80,vx:0,vy:0,hp:100,maxHp:100,col,flip,atkTimer:0,hurtTimer:0}; }
  function init() { p1=mkFighter(120,['#e84040','#ff6060'],false); p2=mkFighter(W-160,['#4080e0','#6090ff'],true); effects=[]; document.getElementById('ftR').textContent=round; }
  function drawFighter(p,label) {
    const x=p.x, y=p.y;
    ctx.save(); if(p.flip){ctx.translate(x+p.w,0);ctx.scale(-1,1);}
    const dx = p.flip ? 0 : x;
    ctx.fillStyle=p.hurtTimer>0?'#fff':p.col[0]; ctx.beginPath(); ctx.roundRect(dx,y+20,p.w,p.h-20,5); ctx.fill();
    ctx.fillStyle=p.hurtTimer>0?'#fff':p.col[1]; ctx.beginPath(); ctx.ellipse(dx+p.w/2,y+12,16,16,0,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.ellipse(dx+26,y+10,4,4,0,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#0c0b08'; ctx.beginPath(); ctx.arc(dx+25,y+10,2.5,0,Math.PI*2); ctx.fill();
    if(p.atkTimer>10){ctx.fillStyle=p.col[1];ctx.fillRect(dx+p.w,y+30,30,10);}
    ctx.restore();
    ctx.fillStyle='rgba(255,255,255,.5)'; ctx.font='700 11px DM Sans,sans-serif'; ctx.textAlign='center'; ctx.fillText(label,x+p.w/2,y-6);
  }
  function attack(attacker,defender) { if(attacker.atkTimer>0)return; const dist=Math.abs(attacker.x-defender.x); if(dist<100){const dmg=12;defender.hp=Math.max(0,defender.hp-dmg);defender.hurtTimer=20;effects.push({x:defender.x+defender.w/2,y:defender.y+30,txt:'-'+dmg,life:30,col:'#e84040'});} attacker.atkTimer=30; }
  function update() {
    fr++;
    p1.vx=0;
    if(keys['a']||keys['A']){p1.vx=-3;p1.flip=false;} if(keys['d']||keys['D']){p1.vx=3;p1.flip=true;}
    if((keys['w']||keys['W'])&&p1.y>=GND-p1.h)p1.vy=-13;
    if(keys['f']||keys['F'])attack(p1,p2); if(keys['g']||keys['G'])attack(p1,p2);
    p2.vx=0;
    if(keys['ArrowLeft']){p2.vx=-3;p2.flip=false;} if(keys['ArrowRight']){p2.vx=3;p2.flip=true;}
    if(keys['ArrowUp']&&p2.y>=GND-p2.h)p2.vy=-13;
    if(keys['l']||keys['L'])attack(p2,p1); if(keys['k']||keys['K'])attack(p2,p1);
    [p1,p2].forEach(p=>{p.vy+=0.7;p.x+=p.vx;p.y+=p.vy;if(p.y>GND-p.h){p.y=GND-p.h;p.vy=0;}p.x=Math.max(0,Math.min(W-p.w,p.x));if(p.atkTimer>0)p.atkTimer--;if(p.hurtTimer>0)p.hurtTimer--;});
    document.getElementById('hp1bar').style.width=(p1.hp/p1.maxHp*100)+'%';
    document.getElementById('hp2bar').style.width=(p2.hp/p2.maxHp*100)+'%';
    if(p1.hp<=0||p2.hp<=0){
      const winner=p1.hp>p2.hp?'ğŸ”´ P1':'ğŸ”µ P2';
      if(p1.hp>p2.hp)w1++;else w2++;
      round++;document.getElementById('ftR').textContent=round;
      effects.push({x:W/2,y:H/2,txt:winner+' WINS!',life:180,col:'#e8c46a',big:true});
      if(w1>=3||w2>=3){state='gameover';}else{setTimeout(()=>{init();},2500);}
    }
  }
  function render() {
    ctx.fillStyle='#1a0a08'; ctx.fillRect(0,0,W,H);
    for(let i=0;i<30;i++){ctx.fillStyle=`hsl(${i*30},30%,20%)`;ctx.fillRect(i*22,0,20,H-80);}
    ctx.fillStyle='#2a1808'; ctx.fillRect(0,GND,W,H-GND);
    ctx.fillStyle='#3a2010'; ctx.fillRect(0,GND,W,12);
    drawFighter(p1,'P1 WASD+FG'); drawFighter(p2,'P2 â†‘â†â†’+LK');
    effects.forEach(ef=>{ctx.font=`${ef.big?'800 28':'700 15'}px ${ef.big?'Syne':'DM Sans'},sans-serif`;ctx.fillStyle=ef.col;ctx.textAlign='center';ctx.fillText(ef.txt,ef.x,ef.y-(30-ef.life)*.5);ef.y-=.5;ef.life--;});
    effects=effects.filter(e=>e.life>0);
    if(state==='idle')cvBanner(ctx,W,H,'STREET FIGHTER','2 Player local battle!','SPACE to Start');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','P to Resume');
    else if(state==='gameover'){const w=w1>=3?'ğŸ”´ Player 1':'ğŸ”µ Player 2';cvBanner(ctx,W,H,w+' Wins!',w1+' â€” '+w2,'SPACE to Play Again');}
    raf=requestAnimationFrame(render); if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  const spH = e => {
    if(e.code==='Space'){if(state==='idle'||state==='gameover'){init();state='running';w1=0;w2=0;round=1;}return;}
    if(e.key==='p'||e.key==='P'){state=state==='paused'?'running':'paused';}
  };
  window.addEventListener('keydown', spH);
  PAUSE_CBS.fighter = p => { state=p?'paused':'running'; };
  CLEANERS.fighter = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown',kH); window.removeEventListener('keyup',kH); window.removeEventListener('keydown',spH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRIVIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.trivia = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center;justify-content:center';
  wrap.innerHTML = `<div style="width:100%;max-width:560px;padding:16px;display:flex;flex-direction:column;gap:14px;align-items:center">
  <div class="hud-row" style="width:100%"><div class="hb"><div class="hl">Score</div><div class="hv" id="tvS">0</div></div><div class="hb"><div class="hl">Question</div><div class="hv" id="tvQ">1/15</div></div><div class="hb"><div class="hl">Streak</div><div class="hv" id="tvSt">0ğŸ”¥</div></div></div>
  <div class="trivia-prog"><div class="trivia-prog-fill" id="tvProg" style="width:0%"></div></div>
  <div class="trivia-q" id="tvQtxt">Loading...</div>
  <div class="trivia-opts" id="tvOpts"></div>
  <div id="tvMsg" style="font-family:var(--font-head);font-size:16px;font-weight:700;color:var(--gold);min-height:22px;text-align:center"></div>
  </div>`;
  const QS=[
    {q:"What is the capital of France?",a:"Paris",opts:["Berlin","Paris","Madrid","Rome"]},
    {q:"How many sides does a hexagon have?",a:"6",opts:["5","6","7","8"]},
    {q:"What planet is known as the Red Planet?",a:"Mars",opts:["Venus","Jupiter","Mars","Saturn"]},
    {q:"Who painted the Mona Lisa?",a:"Leonardo da Vinci",opts:["Picasso","Michelangelo","Leonardo da Vinci","Raphael"]},
    {q:"What is the largest ocean on Earth?",a:"Pacific",opts:["Atlantic","Indian","Arctic","Pacific"]},
    {q:"What is 7 Ã— 8?",a:"56",opts:["48","54","56","64"]},
    {q:"What gas do plants absorb from the air?",a:"Carbon dioxide",opts:["Oxygen","Nitrogen","Carbon dioxide","Hydrogen"]},
    {q:"How many continents are there?",a:"7",opts:["5","6","7","8"]},
    {q:"What is the fastest land animal?",a:"Cheetah",opts:["Lion","Cheetah","Horse","Falcon"]},
    {q:"In what year did World War 2 end?",a:"1945",opts:["1943","1944","1945","1946"]},
    {q:"What is the chemical symbol for Gold?",a:"Au",opts:["Go","Gd","Au","Ag"]},
    {q:"How many strings does a standard guitar have?",a:"6",opts:["4","5","6","7"]},
    {q:"What is the smallest planet in our solar system?",a:"Mercury",opts:["Mars","Mercury","Pluto","Venus"]},
    {q:"Who wrote 'Romeo and Juliet'?",a:"Shakespeare",opts:["Dickens","Shakespeare","Twain","Austen"]},
    {q:"What is the square root of 144?",a:"12",opts:["10","11","12","14"]},
    {q:"What country has the most natural lakes?",a:"Canada",opts:["Russia","USA","Canada","Finland"]},
    {q:"What is the main ingredient in guacamole?",a:"Avocado",opts:["Tomato","Lime","Avocado","Onion"]},
    {q:"How many bones are in the human body?",a:"206",opts:["196","206","216","226"]},
    {q:"What is the longest river in the world?",a:"Nile",opts:["Amazon","Nile","Yangtze","Mississippi"]},
    {q:"What does CPU stand for?",a:"Central Processing Unit",opts:["Central Processing Unit","Computer Power Unit","Core Program Utility","Control Processing Unit"]},
    {q:"Which element has the atomic number 1?",a:"Hydrogen",opts:["Helium","Hydrogen","Lithium","Carbon"]},
    {q:"What sport is played at Wimbledon?",a:"Tennis",opts:["Cricket","Tennis","Golf","Badminton"]},
    {q:"How many players are on a basketball team?",a:"5",opts:["4","5","6","7"]},
    {q:"What is the hardest natural substance?",a:"Diamond",opts:["Gold","Platinum","Diamond","Titanium"]},
    {q:"What language has the most native speakers?",a:"Mandarin Chinese",opts:["English","Spanish","Mandarin Chinese","Hindi"]},
    {q:"What is the powerhouse of the cell?",a:"Mitochondria",opts:["Nucleus","Ribosome","Mitochondria","Golgi Apparatus"]},
    {q:"What year was the iPhone first released?",a:"2007",opts:["2005","2006","2007","2008"]},
    {q:"What does HTML stand for?",a:"HyperText Markup Language",opts:["HyperText Markup Language","High Transfer Markup Link","HyperTransfer Markup Layer","HyperText Machine Language"]},
    {q:"Which planet has the most moons?",a:"Saturn",opts:["Jupiter","Saturn","Uranus","Neptune"]},
    {q:"What is 15% of 200?",a:"30",opts:["20","25","30","35"]},
  ];
  let qList, qIdx, score, streak, ans;
  function shuffle(a) { return [...a].sort(() => Math.random()-.5); }
  function startQuiz() { qList=shuffle(QS).slice(0,15); qIdx=0; score=0; streak=0; document.getElementById('tvS').textContent='0'; document.getElementById('tvSt').textContent='0ğŸ”¥'; showQ(); }
  function showQ() {
    const q=qList[qIdx]; ans=null;
    document.getElementById('tvQtxt').textContent=q.q;
    document.getElementById('tvQ').textContent=(qIdx+1)+'/'+qList.length;
    document.getElementById('tvProg').style.width=(qIdx/qList.length*100)+'%';
    document.getElementById('tvMsg').textContent='';
    const opts=document.getElementById('tvOpts'); opts.innerHTML='';
    shuffle(q.opts).forEach(opt=>{
      const b=document.createElement('div'); b.className='trivia-opt'; b.textContent=opt;
      b.addEventListener('click',()=>{
        if(ans)return; ans=opt;
        const correct=opt===q.a;
        document.querySelectorAll('.trivia-opt').forEach(el=>{el.classList.add('locked');if(el.textContent===q.a)el.classList.add('correct');else if(el.textContent===opt&&!correct)el.classList.add('wrong');});
        if(correct){streak++;score+=100+streak*20;document.getElementById('tvMsg').textContent='âœ… Correct! +'+(100+streak*20);document.getElementById('tvSt').textContent=streak+'ğŸ”¥';}
        else{streak=0;document.getElementById('tvMsg').textContent='âŒ Answer: '+q.a;document.getElementById('tvSt').textContent='0ğŸ”¥';}
        document.getElementById('tvS').textContent=score;
        setTimeout(()=>{qIdx++;if(qIdx<qList.length)showQ();else finish();},1600);
      });
      opts.appendChild(b);
    });
  }
  function finish() { mkOv(wrap,'Quiz Complete! ğŸ‰','Score: '+score+' Â· '+(score>1200?'ğŸ† Expert!':score>800?'â­ Great!':'ğŸ‘ Good effort!'),'<button class="btn-gold" onclick="window._tvNew()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>'); }
  window._tvNew = () => { hideOv(wrap); startQuiz(); };
  startQuiz();
  CLEANERS.trivia = () => { delete window._tvNew; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2048
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.g2048 = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="g2S">0</div></div><div class="hb"><div class="hl">Best</div><div class="hv" id="g2B">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative;touch-action:none">
  <div style="display:flex;flex-direction:column;align-items:center;gap:10px"><div id="b2048"></div><button class="btn-gold" onclick="window._2048n()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Arrow Keys or Swipe to merge tiles</p>`;
  let board, score=0, best=0;
  function addTile(b) { const e=[]; b.forEach((r,y)=>r.forEach((v,x)=>{if(!v)e.push({x,y});})); if(!e.length)return; const{x,y}=e[Math.floor(Math.random()*e.length)]; b[y][x]=Math.random()<.9?2:4; }
  function slide(row) { let r=row.filter(v=>v); for(let i=0;i<r.length-1;i++){if(r[i]===r[i+1]){r[i]*=2;score+=r[i];r.splice(i+1,1);}} while(r.length<4)r.push(0); return r; }
  function move(d) {
    const prev=JSON.stringify(board);
    if(d==='left')board=board.map(r=>slide(r));
    else if(d==='right')board=board.map(r=>slide([...r].reverse()).reverse());
    else{for(let x=0;x<4;x++){let col=board.map(r=>r[x]);if(d==='down')col.reverse();col=slide(col);if(d==='down')col.reverse();board.forEach((r,y)=>r[x]=col[y]);}}
    if(JSON.stringify(board)!==prev)addTile(board);
    if(score>best)best=score;
    document.getElementById('g2S').textContent=score; document.getElementById('g2B').textContent=best; ren2048();
    let mv=false; for(let y=0;y<4;y++)for(let x=0;x<4;x++){if(!board[y][x])mv=true;if(x<3&&board[y][x]===board[y][x+1])mv=true;if(y<3&&board[y][x]===board[y+1][x])mv=true;}
    if(!mv)mkOv(wrap,'GAME OVER','No moves left! Score: '+score,'<button class="btn-gold" onclick="window._2048n()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');
  }
  const TC={2:'t2',4:'t4',8:'t8',16:'t16',32:'t32',64:'t64',128:'t128',256:'t256',512:'t512',1024:'t1024',2048:'t2048'};
  function ren2048() { const b=document.getElementById('b2048'); b.innerHTML=''; board.forEach(row=>row.forEach(v=>{const t=document.createElement('div');t.className='tile'+(v?' '+TC[v]:'');if(v)t.textContent=v;b.appendChild(t);})); }
  window._2048n = () => { board=Array.from({length:4},()=>Array(4).fill(0)); score=0; document.getElementById('g2S').textContent='0'; addTile(board); addTile(board); hideOv(wrap); ren2048(); };
  window._2048n();
  const kH = e => { const m={ArrowLeft:'left',ArrowRight:'right',ArrowUp:'up',ArrowDown:'down'}; if(m[e.key]){e.preventDefault();move(m[e.key]);} };
  window.addEventListener('keydown', kH);
  const bd=document.getElementById('b2048'); let tx=0,ty=0;
  bd.addEventListener('touchstart',e=>{tx=e.touches[0].clientX;ty=e.touches[0].clientY;},{passive:true});
  bd.addEventListener('touchend',e=>{const dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;if(Math.abs(dx)>Math.abs(dy))move(dx>0?'right':'left');else move(dy>0?'down':'up');});
  CLEANERS.g2048 = () => { window.removeEventListener('keydown', kH); delete window._2048n; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MINESWEEPER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.minesweep = function(wrap) {
  const COLS=12, ROWS=10, MINES=16;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">ğŸ’£</div><div class="hv" id="msM">${MINES}</div></div><div class="hb"><div class="hl">â±</div><div class="hv" id="msT">0</div></div><div class="hb"><div class="hl">Status</div><div class="hv" id="msSt">ğŸ˜Š</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:10px"><div id="msG" style="grid-template-columns:repeat(${COLS},1fr)"></div><button class="btn-gold" onclick="window._msN()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Left click=reveal Â· Right click=flag ğŸš©</p>`;
  let board, rev, flagged, over, won, first, timer, el;
  function init() { board=Array.from({length:ROWS},()=>Array(COLS).fill(0)); rev=Array.from({length:ROWS},()=>Array(COLS).fill(false)); flagged=Array.from({length:ROWS},()=>Array(COLS).fill(false)); over=false; won=false; first=true; el=0; clearInterval(timer); document.getElementById('msT').textContent='0'; document.getElementById('msSt').textContent='ğŸ˜Š'; document.getElementById('msM').textContent=MINES; hideOv(wrap); ren(); }
  function place(sx,sy) { let p=0; while(p<MINES){const x=Math.floor(Math.random()*COLS),y=Math.floor(Math.random()*ROWS);if(board[y][x]!=='M'&&!(Math.abs(x-sx)<=1&&Math.abs(y-sy)<=1)){board[y][x]='M';p++;}} for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){if(board[y][x]==='M')continue;let c=0;for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++){const ny=y+dy,nx=x+dx;if(ny>=0&&ny<ROWS&&nx>=0&&nx<COLS&&board[ny][nx]==='M')c++;}board[y][x]=c;} }
  function reveal(x,y) { if(x<0||x>=COLS||y<0||y>=ROWS||rev[y][x]||flagged[y][x])return; rev[y][x]=true; if(board[y][x]===0)for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++)reveal(x+dx,y+dy); }
  function cntF() { let f=0; flagged.forEach(r=>r.forEach(v=>{if(v)f++;})); return f; }
  function checkWin() { for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){if(board[y][x]!=='M'&&!rev[y][x])return false;} return true; }
  function click(x,y) {
    if(over||flagged[y][x]||rev[y][x])return;
    if(first){first=false;place(x,y);timer=setInterval(()=>{el++;document.getElementById('msT').textContent=el;},1000);}
    if(board[y][x]==='M'){rev[y][x]=true;over=true;clearInterval(timer);document.getElementById('msSt').textContent='ğŸ’¥';for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)if(board[r][c]==='M')rev[r][c]=true;mkOv(wrap,'GAME OVER ğŸ’¥','You hit a mine! Time: '+el+'s','<button class="btn-gold" onclick="window._msN()">Try Again</button><button class="btn-out" onclick="goHome()">Exit</button>');}
    else{reveal(x,y);if(checkWin()){won=true;over=true;clearInterval(timer);document.getElementById('msSt').textContent='ğŸ†';mkOv(wrap,'YOU WIN! ğŸ†','Cleared in '+el+' seconds!','<button class="btn-gold" onclick="window._msN()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');}}
    document.getElementById('msM').textContent=MINES-cntF(); ren();
  }
  function flag(x,y) { if(over||rev[y][x])return; flagged[y][x]=!flagged[y][x]; document.getElementById('msM').textContent=MINES-cntF(); ren(); }
  function ren() {
    const g=document.getElementById('msG'); g.innerHTML='';
    for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){
      const c=document.createElement('div'); c.className='mc'; const rx=x,ry=y;
      if(rev[y][x]){c.classList.add('mr');if(board[y][x]==='M'){c.textContent='ğŸ’£';if(over&&!won)c.classList.add('mhit');}else if(board[y][x]>0){c.textContent=board[y][x];c.classList.add('m'+board[y][x]);}}
      else if(flagged[y][x]){c.textContent='ğŸš©';c.classList.add('mf');}
      c.addEventListener('click',()=>click(rx,ry));
      c.addEventListener('contextmenu',e=>{e.preventDefault();flag(rx,ry);});
      let pt; c.addEventListener('touchstart',()=>{pt=setTimeout(()=>flag(rx,ry),500);},{passive:true}); c.addEventListener('touchend',()=>clearTimeout(pt));
      g.appendChild(c);
    }
  }
  window._msN = init; init();
  CLEANERS.minesweep = () => { clearInterval(timer); delete window._msN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PONG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.pong = function(wrap) {
  const W=640, H=400;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="pgCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%"></canvas></div><p style="color:var(--mut);font-size:12px;padding-bottom:8px">P1: W/S Â· P2: â†‘/â†“ Â· Space=Start Â· First to 7!</p>`;
  const cv=document.getElementById('pgCv'), ctx=cv.getContext('2d');
  const PH=78, PW=12, BR=9;
  let p1, p2, ball, sc, state='idle', raf;
  function init() { p1={x:20,y:H/2-PH/2}; p2={x:W-20-PW,y:H/2-PH/2}; resetBall(); sc={p1:0,p2:0}; }
  function resetBall() { const a=(Math.random()*.8-.4)+(Math.random()<.5?0:Math.PI); ball={x:W/2,y:H/2,vx:Math.cos(a)*5,vy:Math.sin(a)*5}; }
  const keys = {};
  const kH = e => { keys[e.key]=e.type==='keydown'; };
  window.addEventListener('keydown', kH); window.addEventListener('keyup', kH);
  const spH = e => {
    if(e.code==='Space'){if(state==='idle'||state==='gameover'){init();state='running';}else if(state==='running')state='paused';else if(state==='paused')state='running';}
    if((e.key==='p'||e.key==='P')&&state!=='idle')state=state==='paused'?'running':'paused';
  };
  window.addEventListener('keydown', spH);
  function update() {
    const sp=6;
    if(keys['w']||keys['W'])p1.y=Math.max(0,p1.y-sp); if(keys['s']||keys['S'])p1.y=Math.min(H-PH,p1.y+sp);
    if(keys['ArrowUp'])p2.y=Math.max(0,p2.y-sp); if(keys['ArrowDown'])p2.y=Math.min(H-PH,p2.y+sp);
    ball.x+=ball.vx; ball.y+=ball.vy;
    if(ball.y-BR<0){ball.y=BR;ball.vy=Math.abs(ball.vy);} if(ball.y+BR>H){ball.y=H-BR;ball.vy=-Math.abs(ball.vy);}
    if(ball.x-BR<p1.x+PW&&ball.y>p1.y&&ball.y<p1.y+PH&&ball.vx<0){ball.vx=Math.abs(ball.vx)+.3;ball.vy+=((ball.y-(p1.y+PH/2))/(PH/2))*3;}
    if(ball.x+BR>p2.x&&ball.y>p2.y&&ball.y<p2.y+PH&&ball.vx>0){ball.vx=-(Math.abs(ball.vx)+.3);ball.vy+=((ball.y-(p2.y+PH/2))/(PH/2))*3;}
    const sm=16; ball.vx=Math.max(-sm,Math.min(sm,ball.vx)); ball.vy=Math.max(-sm,Math.min(sm,ball.vy));
    if(ball.x<0){sc.p2++;if(sc.p2>=7)state='gameover';else resetBall();}
    if(ball.x>W){sc.p1++;if(sc.p1>=7)state='gameover';else resetBall();}
  }
  function render() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    ctx.setLineDash([10,10]); ctx.strokeStyle='#1e1c12'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke(); ctx.setLineDash([]);
    ctx.textAlign='center'; ctx.font='800 48px Syne,sans-serif'; ctx.fillStyle='#222010';
    ctx.fillText(sc.p1,W/4,68); ctx.fillText(sc.p2,3*W/4,68);
    ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.roundRect(p1.x,p1.y,PW,PH,4); ctx.fill(); ctx.beginPath(); ctx.roundRect(p2.x,p2.y,PW,PH,4); ctx.fill();
    ctx.fillStyle='#e8c46a'; ctx.shadowColor='#c9a84c'; ctx.shadowBlur=12; ctx.beginPath(); ctx.arc(ball.x,ball.y,BR,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
    if(state==='idle')cvBanner(ctx,W,H,'PONG','P1: W/S  Â·  P2: â†‘/â†“','SPACE to Start');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','SPACE or P to Resume');
    else if(state==='gameover'){const w=sc.p1>=7?'Player 1 ğŸ†':'Player 2 ğŸ†';cvBanner(ctx,W,H,w+' Wins!',sc.p1+' â€” '+sc.p2,'SPACE to Play Again');}
    raf=requestAnimationFrame(render); if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  PAUSE_CBS.pong = p => { state=p?'paused':'running'; };
  CLEANERS.pong = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown',kH); window.removeEventListener('keyup',kH); window.removeEventListener('keydown',spH); };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONNECT 4
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.connect4 = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Turn</div><div class="hv" id="c4T">ğŸ”´ P1</div></div><div class="hb"><div class="hl">P1 Wins</div><div class="hv" id="c4W1">0</div></div><div class="hb"><div class="hl">P2 Wins</div><div class="hv" id="c4W2">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:10px"><div id="c4board"></div><button class="btn-gold" onclick="window._c4n()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">ğŸ”´ P1 vs ğŸŸ¡ P2 Â· Click a column</p>`;
  const R=6, C=7;
  let board, turn, w1=0, w2=0;
  function init() { board=Array.from({length:R},()=>Array(C).fill(0)); turn=1; document.getElementById('c4T').textContent='ğŸ”´ P1'; hideOv(wrap); ren(); }
  function drop(col) {
    for(let r=R-1;r>=0;r--){if(!board[r][col]){board[r][col]=turn;break;}}
    if(checkWin()){if(turn===1){w1++;document.getElementById('c4W1').textContent=w1;}else{w2++;document.getElementById('c4W2').textContent=w2;}ren();mkOv(wrap,(turn===1?'ğŸ”´ Player 1':'ğŸŸ¡ Player 2')+' Wins!','','<button class="btn-gold" onclick="window._c4n()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');return;}
    if(board[0].every(v=>v)){ren();mkOv(wrap,"It's a Draw!",'','<button class="btn-gold" onclick="window._c4n()">Play Again</button>');return;}
    turn=turn===1?2:1; document.getElementById('c4T').textContent=turn===1?'ğŸ”´ P1':'ğŸŸ¡ P2'; ren();
  }
  function checkWin() {
    const t=turn;
    for(let r=0;r<R;r++)for(let c=0;c<C-3;c++)if(board[r][c]===t&&board[r][c+1]===t&&board[r][c+2]===t&&board[r][c+3]===t)return true;
    for(let r=0;r<R-3;r++)for(let c=0;c<C;c++)if(board[r][c]===t&&board[r+1][c]===t&&board[r+2][c]===t&&board[r+3][c]===t)return true;
    for(let r=0;r<R-3;r++)for(let c=0;c<C-3;c++)if(board[r][c]===t&&board[r+1][c+1]===t&&board[r+2][c+2]===t&&board[r+3][c+3]===t)return true;
    for(let r=3;r<R;r++)for(let c=0;c<C-3;c++)if(board[r][c]===t&&board[r-1][c+1]===t&&board[r-2][c+2]===t&&board[r-3][c+3]===t)return true;
    return false;
  }
  function ren() { const bd=document.getElementById('c4board'); bd.innerHTML=''; for(let r=0;r<R;r++)for(let c=0;c<C;c++){const cell=document.createElement('div');cell.className='c4cell';const rc=c;if(board[r][c]===1)cell.classList.add('c4r');else if(board[r][c]===2)cell.classList.add('c4y');cell.addEventListener('click',()=>{if(board[0][rc])return;drop(rc);});bd.appendChild(cell);} }
  window._c4n = init; init();
  CLEANERS.connect4 = () => { delete window._c4n; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIC-TAC-TOE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.tictac = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Turn</div><div class="hv" id="ttT">âŒ X</div></div><div class="hb"><div class="hl">X Wins</div><div class="hv" id="ttX">0</div></div><div class="hb"><div class="hl">O Wins</div><div class="hv" id="ttO">0</div></div><div class="hb"><div class="hl">Draws</div><div class="hv" id="ttD">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:12px"><canvas id="ttCv" width="300" height="300" style="border-radius:16px;border:1px solid #2a2618;cursor:pointer"></canvas><button class="btn-gold" onclick="window._ttn()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>`;
  const cv=document.getElementById('ttCv'), ctx=cv.getContext('2d');
  let board, turn, wx=0, wo=0, wd=0, over;
  function init() { board=Array(9).fill(null); turn='X'; over=false; document.getElementById('ttT').textContent='âŒ X'; hideOv(wrap); draw(); }
  const LINES=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  function checkWin(b,p) { return LINES.some(l=>l.every(i=>b[i]===p)); }
  function draw() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,300,300);
    ctx.strokeStyle='#2a2618'; ctx.lineWidth=3; ctx.lineCap='round';
    [100,200].forEach(p=>{ctx.beginPath();ctx.moveTo(p,10);ctx.lineTo(p,290);ctx.stroke();ctx.beginPath();ctx.moveTo(10,p);ctx.lineTo(290,p);ctx.stroke();});
    board.forEach((v,i)=>{const cx=50+(i%3)*100,cy=50+Math.floor(i/3)*100;if(v==='X'){ctx.strokeStyle='#e84040';ctx.lineWidth=5;ctx.beginPath();ctx.moveTo(cx-28,cy-28);ctx.lineTo(cx+28,cy+28);ctx.stroke();ctx.beginPath();ctx.moveTo(cx+28,cy-28);ctx.lineTo(cx-28,cy+28);ctx.stroke();}else if(v==='O'){ctx.strokeStyle='#e8c46a';ctx.lineWidth=5;ctx.beginPath();ctx.arc(cx,cy,30,0,Math.PI*2);ctx.stroke();}});
  }
  cv.addEventListener('click', e => {
    if(over)return;
    const r=cv.getBoundingClientRect(); const x=Math.floor((e.clientX-r.left)/100); const y=Math.floor((e.clientY-r.top)/100); const i=y*3+x;
    if(board[i])return; board[i]=turn; draw();
    if(checkWin(board,turn)){over=true;if(turn==='X'){wx++;document.getElementById('ttX').textContent=wx;}else{wo++;document.getElementById('ttO').textContent=wo;}mkOv(wrap,(turn==='X'?'âŒ X':'â­• O')+' Wins!','','<button class="btn-gold" onclick="window._ttn()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');}
    else if(board.every(v=>v)){over=true;wd++;document.getElementById('ttD').textContent=wd;mkOv(wrap,"It's a Draw!",'','<button class="btn-gold" onclick="window._ttn()">Play Again</button>');}
    else{turn=turn==='X'?'O':'X';document.getElementById('ttT').textContent=turn==='X'?'âŒ X':'â­• O';}
  });
  window._ttn = init; init();
  CLEANERS.tictac = () => { delete window._ttn; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BREAKOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.breakout = function(wrap) {
  const W=560, H=420;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="bkS">0</div></div><div class="hb"><div class="hl">Lives</div><div class="hv" id="bkLv">â¤ï¸â¤ï¸â¤ï¸</div></div><div class="hb"><div class="hl">Level</div><div class="hv" id="bkLl">1</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="bkCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;cursor:none;max-width:100%"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Mouse/Touch moves paddle Â· Space/Click to launch</p>`;
  const cv=document.getElementById('bkCv'), ctx=cv.getContext('2d');
  const PW=88, PH=11, BR=8, BC=10, BROWS=6;
  const BCOLS=['#e84040','#e87030','#c9a84c','#50c850','#4080e0','#a050e8'];
  let pad, ball, bricks, score, lives, level, raf, state='idle', launched;
  function mkBricks(lv) { bricks=[]; const bw=(W-36)/BC-5,bh=18; for(let r=0;r<BROWS;r++)for(let c=0;c<BC;c++){const ex=lv>1&&Math.random()<.2?1:0;bricks.push({x:18+c*(bw+5),y:42+r*(bh+5),w:bw,h:bh,hp:1+ex,c:BCOLS[r%BCOLS.length]});} }
  function init() { pad={x:W/2-PW/2,y:H-28}; ball={x:W/2,y:H-48,vx:3,vy:-4}; score=0; lives=3; level=1; launched=false; mkBricks(1); document.getElementById('bkS').textContent='0'; document.getElementById('bkLv').textContent='â¤ï¸â¤ï¸â¤ï¸'; document.getElementById('bkLl').textContent='1'; hideOv(wrap); }
  function update() {
    if(!launched){ball.x=pad.x+PW/2;return;}
    ball.x+=ball.vx; ball.y+=ball.vy;
    if(ball.x-BR<0){ball.x=BR;ball.vx=Math.abs(ball.vx);} if(ball.x+BR>W){ball.x=W-BR;ball.vx=-Math.abs(ball.vx);}
    if(ball.y-BR<0){ball.y=BR;ball.vy=Math.abs(ball.vy);}
    if(ball.y+BR>pad.y&&ball.y+BR<pad.y+PH+ball.vy&&ball.x>pad.x-BR&&ball.x<pad.x+PW+BR){ball.vy=-Math.abs(ball.vy);ball.vx=((ball.x-(pad.x+PW/2))/(PW/2))*5;}
    if(ball.y+BR>H){lives--;document.getElementById('bkLv').textContent='â¤ï¸'.repeat(lives)||'ğŸ’€';if(lives<=0){state='gameover';mkOv(wrap,'GAME OVER','Score: '+score,'<button class="btn-gold" onclick="window._bkN()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');return;}ball={x:W/2,y:H-48,vx:3,vy:-4};launched=false;}
    bricks.forEach(b=>{if(b.dead)return;if(ball.x+BR>b.x&&ball.x-BR<b.x+b.w&&ball.y+BR>b.y&&ball.y-BR<b.y+b.h){b.hp--;if(b.hp<=0)b.dead=true;const fT=Math.abs((ball.y+BR)-b.y),fB=Math.abs((ball.y-BR)-(b.y+b.h)),fL=Math.abs((ball.x+BR)-b.x),fR=Math.abs((ball.x-BR)-(b.x+b.w));if(Math.min(fT,fB)<Math.min(fL,fR))ball.vy*=-1;else ball.vx*=-1;score+=10*level;document.getElementById('bkS').textContent=score;}});
    bricks=bricks.filter(b=>!b.dead);
    if(!bricks.length){level++;document.getElementById('bkLl').textContent=level;mkBricks(level);ball={x:W/2,y:H-48,vx:3+level*.4,vy:-(4+level*.4)};launched=false;}
  }
  function render() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    bricks.forEach(b=>{ctx.fillStyle=b.hp>1?'#fff8e0':b.c;ctx.beginPath();ctx.roundRect(b.x,b.y,b.w,b.h,3);ctx.fill();ctx.fillStyle='rgba(255,255,255,.18)';ctx.fillRect(b.x+2,b.y+2,b.w-4,3);});
    ctx.fillStyle='#c9a84c'; ctx.beginPath(); ctx.roundRect(pad.x,pad.y,PW,PH,6); ctx.fill();
    ctx.fillStyle='#e8c46a'; ctx.shadowColor='#c9a84c'; ctx.shadowBlur=10; ctx.beginPath(); ctx.arc(ball.x,ball.y,BR,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
    if(!launched&&state==='running'){ctx.textAlign='center';ctx.font='700 12px DM Sans,sans-serif';ctx.fillStyle='#857d5f';ctx.fillText('Click / Space to launch',W/2,H-46);}
    if(state==='idle')cvBanner(ctx,W,H,'BREAKOUT','Smash all the bricks!','Click or Space to Start');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','P to Resume');
    raf=requestAnimationFrame(render); if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  cv.addEventListener('mousemove',e=>{const r=cv.getBoundingClientRect();pad.x=Math.max(0,Math.min(W-PW,(e.clientX-r.left)-PW/2));});
  cv.addEventListener('touchmove',e=>{e.preventDefault();const r=cv.getBoundingClientRect();pad.x=Math.max(0,Math.min(W-PW,(e.touches[0].clientX-r.left)-PW/2));},{passive:false});
  cv.addEventListener('click',()=>{if(state==='idle'){init();state='running';return;}if(state==='running'&&!launched)launched=true;});
  const kH = e => { if(e.key==='p'||e.key==='P'){state=state==='paused'?'running':'paused';return;} if(e.code==='Space'){e.preventDefault();if(state==='idle'){init();state='running';}else if(state==='running'&&!launched)launched=true;} if(state!=='running')return; if(e.key==='ArrowLeft')pad.x=Math.max(0,pad.x-20); if(e.key==='ArrowRight')pad.x=Math.min(W-PW,pad.x+20); };
  window.addEventListener('keydown', kH);
  window._bkN = () => { init(); state='running'; };
  PAUSE_CBS.breakout = p => { state=p?'paused':'running'; };
  CLEANERS.breakout = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown', kH); delete window._bkN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEMORY MATCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.memory = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Moves</div><div class="hv" id="mmMv">0</div></div><div class="hb"><div class="hl">Pairs</div><div class="hv" id="mmPr">0/8</div></div><div class="hb"><div class="hl">â±</div><div class="hv" id="mmTm">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:12px"><div id="mmGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px"></div><button class="btn-gold" onclick="window._mmN()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>`;
  const EM=['ğŸ','ğŸ§±','ğŸ”¢','ğŸ¦','ğŸ¦•','ğŸ’£','ğŸ“','ğŸ‘¾'];
  let cards, flipped, pairs, moves, timer, el, lock;
  function init() { const all=[...EM,...EM].sort(()=>Math.random()-.5); cards=all.map((e,i)=>({id:i,e,flipped:false,matched:false})); flipped=[]; pairs=0; moves=0; el=0; lock=false; clearInterval(timer); document.getElementById('mmMv').textContent='0'; document.getElementById('mmPr').textContent='0/8'; document.getElementById('mmTm').textContent='0'; hideOv(wrap); ren(); timer=setInterval(()=>{el++;document.getElementById('mmTm').textContent=el;},1000); }
  function flip(i) {
    if(lock||cards[i].flipped||cards[i].matched)return;
    cards[i].flipped=true; flipped.push(i); ren();
    if(flipped.length===2){moves++;document.getElementById('mmMv').textContent=moves;lock=true;setTimeout(()=>{if(cards[flipped[0]].e===cards[flipped[1]].e){cards[flipped[0]].matched=cards[flipped[1]].matched=true;pairs++;document.getElementById('mmPr').textContent=pairs+'/8';if(pairs===8){clearInterval(timer);mkOv(wrap,'You Won! ğŸ‰','Moves: '+moves+' Â· Time: '+el+'s','<button class="btn-gold" onclick="window._mmN()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');}}else{cards[flipped[0]].flipped=cards[flipped[1]].flipped=false;}flipped=[];lock=false;ren();},900);}
  }
  function ren() {
    const g=document.getElementById('mmGrid'); g.innerHTML='';
    cards.forEach((c,i)=>{const d=document.createElement('div');d.style.cssText=`width:72px;height:72px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px solid;transition:all .2s;user-select:none;`;if(c.matched){d.style.background='rgba(80,200,80,.12)';d.style.borderColor='#50c850';d.style.fontSize='30px';d.textContent=c.e;}else if(c.flipped){d.style.background='var(--surf2)';d.style.borderColor='var(--gold)';d.style.fontSize='30px';d.textContent=c.e;}else{d.style.background='var(--surf)';d.style.borderColor='var(--bord2)';d.style.color='var(--mut2)';d.style.fontFamily='Syne,sans-serif';d.style.fontWeight='700';d.style.fontSize='22px';d.textContent='?';}d.addEventListener('click',()=>flip(i));g.appendChild(d);});
  }
  window._mmN = () => { clearInterval(timer); init(); };
  init();
  CLEANERS.memory = () => { clearInterval(timer); delete window._mmN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WORDLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.wordle = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:12px;max-width:320px;width:100%"><div style="font-family:var(--font-head);font-size:11px;font-weight:700;letter-spacing:2px;color:var(--mut);text-transform:uppercase">Guess the 5-Letter Word</div><div id="wgrid"></div><div id="wmsg" style="font-family:var(--font-head);font-size:14px;font-weight:700;color:var(--gold);min-height:20px;text-align:center"></div><div class="wkb" id="wkb"></div><button class="btn-gold" onclick="window._wN()" style="padding:8px 22px;font-size:12px">New Word</button></div></div>`;
  const WS=['CRANE','BLAZE','GHOST','FLAME','STORM','GRIND','CHEST','BRINE','FLINT','PLUMB','CRISP','DRAFT','GLOOM','STARK','BRAND','CLEFT','DWELT','FROZE','GRIPE','SLANT','TROVE','EXPEL','FLUNG','BLOAT','CLAMP','DROWN','FETCH','GLARE','KNACK','BRAVE','CLING','DWARF','EPOCH','FRAIL','GROAN','SHRUG','CREST','BLUNT','DRAPE','GLEAM','STOCK','PHONE','BRAVE','CROWN','PLANT','STORK','GRAZE'];
  const EXTRA=['CRANE','SPATE','STARE','AUDIO','RAISE','ARISE','IRATE','STALE','SLATE','FLEAS','LEAST'];
  let word, guesses, cur, over;
  function init() { word=WS[Math.floor(Math.random()*WS.length)]; guesses=[]; cur=''; over=false; document.getElementById('wmsg').textContent=''; renGrid(); renKB(); }
  function score2(w,g) { const res=Array(5).fill('absent'); const wa=[...w]; const used=Array(5).fill(false); for(let i=0;i<5;i++){if(g[i]===w[i]){res[i]='correct';used[i]=true;}} for(let i=0;i<5;i++){if(res[i]==='correct')continue;const idx=wa.findIndex((c,j)=>!used[j]&&c===g[i]);if(idx!==-1){res[i]='present';used[idx]=true;}} return res; }
  function getKB() { const st={}; guesses.forEach(g=>{const res=score2(word,g);g.split('').forEach((c,i)=>{if(res[i]==='correct')st[c]='wc';else if(res[i]==='present'&&st[c]!=='wc')st[c]='wp';else if(!st[c])st[c]='wa';});}); return st; }
  function renGrid() { const g=document.getElementById('wgrid'); g.innerHTML=''; for(let r=0;r<6;r++){const row=document.createElement('div');row.className='wrow';const gs=guesses[r]||'';for(let c=0;c<5;c++){const l=document.createElement('div');l.className='wletter';if(r===guesses.length&&!over)l.classList.add('cur');const ch=r<guesses.length?gs[c]:(r===guesses.length?cur[c]||'':'');if(ch)l.textContent=ch;if(r<guesses.length){const res=score2(word,gs);l.classList.add(res[c]);}row.appendChild(l);}g.appendChild(row);} }
  function renKB() { const kb=document.getElementById('wkb'); kb.innerHTML=''; const rows=[['Q','W','E','R','T','Y','U','I','O','P'],['A','S','D','F','G','H','J','K','L'],['ENTER','Z','X','C','V','B','N','M','âŒ«']]; const st=getKB(); rows.forEach(row=>{const d=document.createElement('div');d.className='wkrow';row.forEach(k=>{const b=document.createElement('div');b.className='wk';if(k==='ENTER'||k==='âŒ«')b.classList.add('wide');b.textContent=k;if(st[k])b.classList.add(st[k]);b.addEventListener('click',()=>kbP(k));d.appendChild(b);});kb.appendChild(d);}); }
  function kbP(k) {
    if(over)return;
    if(k==='âŒ«')cur=cur.slice(0,-1);
    else if(k==='ENTER'){if(cur.length<5){document.getElementById('wmsg').textContent='Need 5 letters!';setTimeout(()=>document.getElementById('wmsg').textContent='',1200);return;}if(!WS.includes(cur)&&!EXTRA.includes(cur)){document.getElementById('wmsg').textContent='Not in word list';setTimeout(()=>document.getElementById('wmsg').textContent='',1200);return;}guesses.push(cur);cur='';if(guesses[guesses.length-1]===word){over=true;document.getElementById('wmsg').textContent='ğŸ‰ '+word+' â€” Brilliant!';}else if(guesses.length===6){over=true;document.getElementById('wmsg').textContent='The word was: '+word;}}
    else if(cur.length<5)cur+=k;
    renGrid(); renKB();
  }
  const kH = e => { if(over)return; if(e.key==='Backspace')kbP('âŒ«'); else if(e.key==='Enter')kbP('ENTER'); else if(/^[a-zA-Z]$/.test(e.key))kbP(e.key.toUpperCase()); };
  window.addEventListener('keydown', kH);
  window._wN = init; init();
  CLEANERS.wordle = () => { window.removeEventListener('keydown', kH); delete window._wN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TYPING SPEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.typing = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">WPM</div><div class="hv" id="tyW">0</div></div><div class="hb"><div class="hl">Accuracy</div><div class="hv" id="tyA">100%</div></div><div class="hb"><div class="hl">Time</div><div class="hv" id="tyT">60</div></div><div class="hb"><div class="hl">Words</div><div class="hv" id="tyWd">0</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative;width:100%"><div style="max-width:600px;width:100%;display:flex;flex-direction:column;gap:12px">
  <div class="ty-text-wrap" id="tyTxt"></div>
  <input id="tyInp" placeholder="Click here and start typing..." autocomplete="off" autocorrect="off" spellcheck="false" style="width:100%;padding:13px 20px;background:var(--surf);border:1px solid var(--bord2);border-radius:12px;font-size:15px;font-family:inherit;outline:none;color:var(--txt);" onfocus="this.style.borderColor='var(--gold4)'" onblur="this.style.borderColor='var(--bord2)'"/>
  <div style="display:flex;gap:10px;justify-content:center"><button class="btn-gold" onclick="window._tyN(30)" style="padding:8px 18px;font-size:12px">30s</button><button class="btn-gold" onclick="window._tyN(60)" style="padding:8px 18px;font-size:12px">60s</button><button class="btn-gold" onclick="window._tyN(120)" style="padding:8px 18px;font-size:12px">120s</button></div></div></div>`;
  const WDS=['the','be','to','of','and','a','in','that','have','it','for','not','on','with','he','as','you','do','at','this','but','his','by','from','they','we','say','her','she','or','an','will','my','one','all','would','there','their','what','so','up','out','if','about','who','get','which','go','me','when','make','can','like','time','no','just','him','know','take','people','into','year','your','good','some','could','them','see','other','than','then','now','look','only','come','its','over','think','also','back','after','use','two','how','our','work','first','well','way','even','new','want','because','any','these','give','day','most','us'];
  let text, cur, correct, errors, start, timer, el, total, done;
  function newGame(t=60) { total=t; el=0; done=false; cur=0; correct=0; errors=0; start=null; clearInterval(timer); text=[...WDS].sort(()=>Math.random()-.5).slice(0,60); document.getElementById('tyW').textContent='0'; document.getElementById('tyA').textContent='100%'; document.getElementById('tyT').textContent=t; document.getElementById('tyWd').textContent='0'; document.getElementById('tyInp').value=''; document.getElementById('tyInp').disabled=false; document.getElementById('tyInp').focus(); hideOv(wrap); renTy(); }
  function renTy() { const d=document.getElementById('tyTxt'); d.innerHTML=''; text.forEach((w,i)=>{const sp=document.createElement('span');sp.textContent=w+' ';if(i<cur)sp.style.color='#50c850';else if(i===cur)sp.style.color='#e8c46a';d.appendChild(sp);}); }
  document.getElementById('tyInp').addEventListener('input', e => {
    if(done)return;
    if(!start){start=Date.now();timer=setInterval(()=>{el++;const rem=total-el;document.getElementById('tyT').textContent=rem;if(rem<=0)finish();},1000);}
    const val=e.target.value;
    if(val.endsWith(' ')){const typed=val.trim();if(typed===text[cur])correct++;else errors++;cur++;e.target.value='';if(cur>=text.length){finish();return;}renTy();document.getElementById('tyWd').textContent=cur;document.getElementById('tyW').textContent=Math.round((correct/Math.max(el,1))*60)||0;document.getElementById('tyA').textContent=(cur>0?Math.round(correct/cur*100):100)+'%';}
  });
  function finish() { clearInterval(timer); done=true; document.getElementById('tyInp').disabled=true; const wpm=Math.round(correct/total*60); const acc=cur>0?Math.round(correct/cur*100):0; mkOv(wrap,'âŒ¨ï¸ Time\'s Up!','WPM: '+wpm+' Â· Accuracy: '+acc+'% Â· Words: '+correct,'<button class="btn-gold" onclick="window._tyN(60)">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>'); }
  window._tyN = newGame; newGame(60);
  CLEANERS.typing = () => { clearInterval(timer); delete window._tyN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECKERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.checkers = function(wrap) {
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Turn</div><div class="hv" id="ckT">ğŸ”´ P1</div></div><div class="hb"><div class="hl">ğŸ”´ Pieces</div><div class="hv" id="ck1">12</div></div><div class="hb"><div class="hl">âš« Pieces</div><div class="hv" id="ck2">12</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:12px;position:relative"><div style="display:flex;flex-direction:column;align-items:center;gap:10px"><canvas id="ckCv" width="360" height="360" style="border-radius:12px;border:1px solid #2a2618;cursor:pointer"></canvas><button class="btn-gold" onclick="window._ckN()" style="padding:9px 24px;font-size:13px">New Game</button></div></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">ğŸ”´ P1 vs âš« P2 Â· Click to select & move</p>`;
  const cv=document.getElementById('ckCv'), ctx=cv.getContext('2d');
  const SZ=45, N=8;
  let board, turn, sel, over;
  function init() { board=Array.from({length:N},()=>Array(N).fill(0)); for(let r=0;r<3;r++)for(let c=0;c<N;c++){if((r+c)%2===1)board[r][c]=2;} for(let r=5;r<8;r++)for(let c=0;c<N;c++){if((r+c)%2===1)board[r][c]=1;} turn=1; sel=null; over=false; hideOv(wrap); draw(); }
  function draw() {
    ctx.clearRect(0,0,360,360);
    for(let r=0;r<N;r++)for(let c=0;c<N;c++){ctx.fillStyle=(r+c)%2===0?'#1a1810':'#2e2a18';ctx.fillRect(c*SZ,r*SZ,SZ,SZ);}
    if(sel){const moves=getMoves(sel.r,sel.c);moves.forEach(m=>{ctx.fillStyle='rgba(201,168,76,.3)';ctx.beginPath();ctx.arc(m.c*SZ+SZ/2,m.r*SZ+SZ/2,SZ/2-4,0,Math.PI*2);ctx.fill();});}
    for(let r=0;r<N;r++)for(let c=0;c<N;c++){const v=board[r][c];if(!v)continue;const x=c*SZ+SZ/2,y=r*SZ+SZ/2;const isSel=sel&&sel.r===r&&sel.c===c;ctx.fillStyle=isSel?'#e8c46a':v===1||v===3?'#c83030':v===2||v===4?'#606060':'#000';ctx.shadowColor=isSel?'#e8c46a':v===1?'#e84040':'#888';ctx.shadowBlur=isSel?16:4;ctx.beginPath();ctx.arc(x,y,SZ/2-5,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;if(v===3||v===4){ctx.fillStyle='rgba(255,255,255,.4)';ctx.font='700 16px Syne,sans-serif';ctx.textAlign='center';ctx.fillText('â™”',x,y+6);}}
  }
  function getMoves(r,c) { const v=board[r][c];if(!v)return[];const dirs=[];if(v===1||v===3)dirs.push([-1,-1],[-1,1]);if(v===2||v===4)dirs.push([1,-1],[1,1]);if(v===3||v===4)dirs.push([1,-1],[1,1],[-1,-1],[-1,1]);const moves=[];dirs.forEach(([dr,dc])=>{const nr=r+dr,nc=c+dc;if(nr>=0&&nr<N&&nc>=0&&nc<N&&!board[nr][nc])moves.push({r:nr,c:nc,jump:false});else if(nr>=0&&nr<N&&nc>=0&&nc<N&&board[nr][nc]&&Math.floor((board[nr][nc]-1)/2)!==Math.floor((v-1)/2)){const jr=r+dr*2,jc=c+dc*2;if(jr>=0&&jr<N&&jc>=0&&jc<N&&!board[jr][jc])moves.push({r:jr,c:jc,jump:true,cr:nr,cc:nc});}});return moves; }
  function click(r,c) {
    if(over)return;
    if(board[r][c]&&((board[r][c]===1||board[r][c]===3)&&turn===1||(board[r][c]===2||board[r][c]===4)&&turn===2)){sel={r,c};draw();return;}
    if(sel){const moves=getMoves(sel.r,sel.c);const mv=moves.find(m=>m.r===r&&m.c===c);if(mv){board[r][c]=board[sel.r][sel.c];board[sel.r][sel.c]=0;if(mv.jump){board[mv.cr][mv.cc]=0;}if(turn===1&&r===0)board[r][c]=3;if(turn===2&&r===7)board[r][c]=4;const r1=board.flat().filter(v=>v===1||v===3).length;const r2=board.flat().filter(v=>v===2||v===4).length;document.getElementById('ck1').textContent=r1;document.getElementById('ck2').textContent=r2;if(!r1||!r2){over=true;mkOv(wrap,(r2===0?'ğŸ”´ Player 1':'âš« Player 2')+' Wins!','','<button class="btn-gold" onclick="window._ckN()">Play Again</button><button class="btn-out" onclick="goHome()">Exit</button>');}turn=turn===1?2:1;document.getElementById('ckT').textContent=turn===1?'ğŸ”´ P1':'âš« P2';}sel=null;}draw();
  }
  cv.addEventListener('click', e => { const r=cv.getBoundingClientRect();const c=Math.floor((e.clientX-r.left)/SZ),row=Math.floor((e.clientY-r.top)/SZ);click(row,c); });
  window._ckN = init; init();
  CLEANERS.checkers = () => { delete window._ckN; };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAC-MAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUILDERS.pacman = function(wrap) {
  const CELL=24, MC=19, MR=17, W=MC*CELL, H=MR*CELL;
  wrap.style.cssText = 'flex-direction:column;align-items:center';
  wrap.innerHTML = `<div class="hud-row"><div class="hb"><div class="hl">Score</div><div class="hv" id="pmS">0</div></div><div class="hb"><div class="hl">Lives</div><div class="hv" id="pmLv">â¤ï¸â¤ï¸â¤ï¸</div></div><div class="hb"><div class="hl">Level</div><div class="hv" id="pmLl">1</div></div></div>
  <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:10px;position:relative;width:100%"><canvas id="pmCv" width="${W}" height="${H}" style="border-radius:12px;border:1px solid #2a2618;max-width:100%"></canvas></div>
  <p style="color:var(--mut);font-size:12px;padding-bottom:8px">Arrow Keys / WASD Â· Space=Start Â· P=Pause</p>`;
  const cv=document.getElementById('pmCv'), ctx=cv.getContext('2d');
  const MT=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,1],[1,3,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,3,1],[1,2,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,2,1],[1,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,1],[1,1,1,1,2,1,1,0,0,0,0,0,1,1,2,1,1,1,1],[1,1,1,1,2,1,0,0,0,0,0,0,0,1,2,1,1,1,1],[0,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0],[1,1,1,1,2,1,0,0,0,0,0,0,0,1,2,1,1,1,1],[1,1,1,1,2,1,0,1,1,1,1,1,0,1,2,1,1,1,1],[1,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,1],[1,2,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,2,1],[1,3,2,1,2,2,2,2,2,0,2,2,2,2,2,1,2,3,1],[1,1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1,1],[1,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,1]];
  let map, pac, ghosts, score, lives, level, dir, ndir, powered, pTimer, raf, state='idle', dots, fr=0;
  const GC=['#ff4040','#ffb8ff','#00d4d4','#ffb852'];
  function initMap() { map=MT.map(r=>[...r]); dots=0; map.forEach(r=>r.forEach(v=>{if(v===2||v===3)dots++;})); }
  function canGo(x,y) { if(y<0||y>=MR||x<0||x>=MC)return true; return map[Math.round(y)][Math.round(x)]!==1; }
  function init() { initMap(); pac={x:9,y:14,mo:0,md:1}; dir={x:1,y:0}; ndir={x:1,y:0}; score=0; lives=3; level=1; powered=false; pTimer=0; upHUD(); ghosts=[{x:8,y:9,vx:1,vy:0,c:GC[0],sc:false},{x:10,y:9,vx:-1,vy:0,c:GC[1],sc:false},{x:9,y:8,vx:0,vy:1,c:GC[2],sc:false},{x:9,y:10,vx:0,vy:-1,c:GC[3],sc:false}]; }
  function upHUD() { document.getElementById('pmS').textContent=score; document.getElementById('pmLv').textContent='â¤ï¸'.repeat(lives)||'ğŸ’€'; document.getElementById('pmLl').textContent=level; }
  function update() {
    fr++;
    pac.mo+=pac.md*.13; if(pac.mo>.37||pac.mo<0)pac.md*=-1;
    const nx=Math.round(pac.x)+ndir.x, ny=Math.round(pac.y)+ndir.y;
    if(canGo(nx,ny))dir={...ndir};
    const mx=pac.x+dir.x*.13, my=pac.y+dir.y*.13;
    if(canGo(Math.round(mx),Math.round(my))){pac.x=((mx+MC)%MC);pac.y=((my+MR)%MR);}
    const gx=Math.round(pac.x), gy=Math.round(pac.y);
    if(gy>=0&&gy<MR&&gx>=0&&gx<MC){if(map[gy][gx]===2){map[gy][gx]=0;score+=10;dots--;upHUD();}if(map[gy][gx]===3){map[gy][gx]=0;score+=50;dots--;powered=true;pTimer=300;ghosts.forEach(g=>g.sc=true);upHUD();}}
    if(dots<=0){level++;initMap();upHUD();return;}
    if(powered){pTimer--;if(pTimer<=0){powered=false;ghosts.forEach(g=>g.sc=false);}}
    if(fr%5===0){ghosts.forEach(g=>{const opts=[];[[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{if(canGo(Math.round(g.x)+dx,Math.round(g.y)+dy)&&!(dx===-g.vx&&dy===-g.vy))opts.push({dx,dy});});if(opts.length){if(!g.sc){opts.sort((a,b)=>Math.hypot(g.x+a.dx-pac.x,g.y+a.dy-pac.y)-Math.hypot(g.x+b.dx-pac.x,g.y+b.dy-pac.y));const pk=Math.random()<.7?opts[0]:opts[Math.floor(Math.random()*opts.length)];g.vx=pk.dx;g.vy=pk.dy;}else{const pk=opts[Math.floor(Math.random()*opts.length)];g.vx=pk.dx;g.vy=pk.dy;}}g.x=((g.x+g.vx*.11)+MC)%MC;g.y=((g.y+g.vy*.11)+MR)%MR;if(Math.hypot(g.x-pac.x,g.y-pac.y)<.85){if(g.sc){g.sc=false;score+=200;upHUD();g.x=9;g.y=9;}else{lives--;upHUD();if(lives<=0){state='gameover';return;}pac={x:9,y:14,mo:0,md:1};dir={x:1,y:0};ndir={x:1,y:0};ghosts=[{x:8,y:9,vx:1,vy:0,c:GC[0],sc:false},{x:10,y:9,vx:-1,vy:0,c:GC[1],sc:false},{x:9,y:8,vx:0,vy:1,c:GC[2],sc:false},{x:9,y:10,vx:0,vy:-1,c:GC[3],sc:false}];}}})}
  }
  function drawPac() { const px=pac.x*CELL+CELL/2,py=pac.y*CELL+CELL/2,r=CELL/2-2;const a=dir.x===1?0:dir.x===-1?Math.PI:dir.y===1?Math.PI/2:Math.PI*1.5;ctx.fillStyle='#e8c46a';ctx.beginPath();ctx.moveTo(px,py);ctx.arc(px,py,r,a+pac.mo,a+Math.PI*2-pac.mo);ctx.closePath();ctx.fill(); }
  function drawGhost(g) { const px=g.x*CELL+CELL/2,py=g.y*CELL+CELL/2,r=CELL/2-2;const sc=g.sc&&pTimer>30;ctx.fillStyle=sc?(pTimer<80&&fr%10<5?'#8080e0':'#2040d0'):g.c;ctx.beginPath();ctx.arc(px,py-r*.1,r,Math.PI,0,false);ctx.lineTo(px+r,py+r);for(let i=0;i<3;i++)ctx.quadraticCurveTo(px+r-(i+.5)*(2*r/3),py+r+4,px+r-(i+1)*(2*r/3),py+r);ctx.lineTo(px-r,py+r);ctx.closePath();ctx.fill();if(!sc){ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(px-3,py-2,3.5,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(px+3,py-2,3.5,0,Math.PI*2);ctx.fill();ctx.fillStyle='#00f';ctx.beginPath();ctx.arc(px-2,py-2,1.8,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(px+4,py-2,1.8,0,Math.PI*2);ctx.fill();} }
  function render() {
    ctx.fillStyle='#0c0b08'; ctx.fillRect(0,0,W,H);
    for(let y=0;y<MR;y++)for(let x=0;x<MC;x++){const v=map[y][x];if(v===1){ctx.fillStyle='#1a3a8a';ctx.beginPath();ctx.roundRect(x*CELL+1,y*CELL+1,CELL-2,CELL-2,3);ctx.fill();ctx.strokeStyle='#2050c0';ctx.lineWidth=1;ctx.beginPath();ctx.roundRect(x*CELL+2,y*CELL+2,CELL-4,CELL-4,2);ctx.stroke();}else if(v===2){ctx.fillStyle='#c9a84c';ctx.beginPath();ctx.arc(x*CELL+CELL/2,y*CELL+CELL/2,2.5,0,Math.PI*2);ctx.fill();}else if(v===3){const p=.8+Math.sin(fr*.1)*.2;ctx.fillStyle='#e8c46a';ctx.beginPath();ctx.arc(x*CELL+CELL/2,y*CELL+CELL/2,6*p,0,Math.PI*2);ctx.fill();}}
    if(state!=='idle')drawPac();
    ghosts.forEach(drawGhost);
    if(state==='idle')cvBanner(ctx,W,H,'PAC-MAN','Eat dots â€” dodge ghosts!','SPACE to Start');
    else if(state==='paused')cvBanner(ctx,W,H,'PAUSED','','SPACE / P to Resume');
    else if(state==='gameover')cvBanner(ctx,W,H,'GAME OVER','Score: '+score,'SPACE to Retry');
    raf=requestAnimationFrame(render); if(state==='running')update();
  }
  raf=requestAnimationFrame(render);
  const kH = e => {
    if(e.key==='p'||e.key==='P'){state=state==='paused'?'running':'paused';return;}
    if(e.code==='Space'){if(state==='idle'||state==='gameover'){init();state='running';}else if(state==='running')state='paused';else if(state==='paused')state='running';return;}
    if(state!=='running')return;
    const dm={ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},a:{x:-1,y:0},d:{x:1,y:0},w:{x:0,y:-1},s:{x:0,y:1}};
    if(dm[e.key]){e.preventDefault();ndir=dm[e.key];}
  };
  window.addEventListener('keydown', kH);
  let tx2=0, ty2=0;
  cv.addEventListener('touchstart',e=>{tx2=e.touches[0].clientX;ty2=e.touches[0].clientY;},{passive:true});
  cv.addEventListener('touchend',e=>{if(state==='idle'||state==='gameover'){init();state='running';return;}const dx=e.changedTouches[0].clientX-tx2,dy=e.changedTouches[0].clientY-ty2;if(Math.abs(dx)>Math.abs(dy))ndir=dx>0?{x:1,y:0}:{x:-1,y:0};else ndir=dy>0?{x:0,y:1}:{x:0,y:-1};});
  PAUSE_CBS.pacman = p => { state=p?'paused':'running'; };
  CLEANERS.pacman = () => { cancelAnimationFrame(raf); window.removeEventListener('keydown', kH); };
};

</script>
</body>
</html>
